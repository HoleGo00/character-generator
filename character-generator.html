<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>è§’è‰²ç”Ÿæˆå™¨</title>

    <!-- 
          ============================= å¤šä¸–ç•ŒèƒŒæ™¯é¢œè‰²é…ç½® =============================
          
          ğŸ¨ å¿«é€Ÿä¿®æ”¹è¯´æ˜ï¼š
          1. æƒ³è¦æ”¹å˜æ•´ä½“ä¸»é¢˜è‰²ï¼Ÿ â†’ ä¿®æ”¹ --primary-colorã€--primary-darkã€--primary-darker
          2. æƒ³è¦æ”¹å˜æ–‡å­—é¢œè‰²ï¼Ÿ   â†’ ä¿®æ”¹ --secondary-color  
          3. æƒ³è¦æ”¹å˜é¢æ¿é¢œè‰²ï¼Ÿ   â†’ ä¿®æ”¹ --panel-bg
          4. æƒ³è¦æ”¹å˜æç¤ºé¢œè‰²ï¼Ÿ   â†’ ä¿®æ”¹ --success-colorã€--error-color ç­‰
          
          ğŸ¨ è¯¦ç»†è¯´æ˜ï¼š
          --primary-color: ä¸»è‰²è°ƒ (#313a3d) â†’ é¡µé¢èƒŒæ™¯æ¸å˜ã€é€‰ä¸­çŠ¶æ€æ–‡å­—è‰²
          --primary-dark: æ·±è‰²è°ƒ (#2a3235) â†’ é¡µé¢èƒŒæ™¯æ¸å˜ä¸­é—´è‰²  
          --primary-darker: æ›´æ·±è‰² (#212a2d) â†’ é¡µé¢èƒŒæ™¯æ¸å˜åº•è‰²
          --secondary-color: è¾…åŠ©è‰² (#ebd7d7) â†’ ä¸»è¦æ–‡å­—é¢œè‰²ã€æŒ‰é’®è¾¹æ¡†è‰²
          --panel-bg: é¢æ¿è‰² (#313a3d) â†’ æ‰€æœ‰è¾“å…¥æ¡†ã€é€‰æ‹©æ¡†ã€æŒ‰é’®èƒŒæ™¯è‰²
          --success-color: æˆåŠŸè‰² (#4ade80) â†’ æˆåŠŸæç¤ºæ–‡å­—é¢œè‰²
          --error-color: é”™è¯¯è‰² (#f87171) â†’ é”™è¯¯æç¤ºã€è­¦å‘Šè¾¹æ¡†é¢œè‰²  
          --muted-color: é™éŸ³è‰² (#a1a1aa) â†’ ç¦ç”¨çŠ¶æ€æ–‡å­—é¢œè‰²
          --accent-color: å¼ºè°ƒè‰² (#c084fc) â†’ ç‰¹æ®Šæ ‡è®°ã€é«˜äº®é¢œè‰²
          
          ğŸ’¡ ä¿®æ”¹æç¤ºï¼šç›´æ¥æ›¿æ¢é¢œè‰²ä»£ç å³å¯ï¼Œå¦‚ #ff0000(çº¢è‰²) #00ff00(ç»¿è‰²) #0000ff(è“è‰²)
          ========================================================================
          -->
    <style>
      :root {
        /* ä¸»è¦é¢œè‰² - å°†ç”±JavaScriptæ ¹æ®ä¸–ç•ŒèƒŒæ™¯åŠ¨æ€è®¾ç½® */
        --primary-color: #313a3d;
        --primary-dark: #2a3235;
        --primary-darker: #212a2d;
        --secondary-color: #ebd7d7;

        /* é¢æ¿é¢œè‰² */
        --panel-bg: #313a3d;
        --panel-bg-opacity: 0.9;

        /* åŠŸèƒ½é¢œè‰² */
        --success-color: #4ade80;
        --error-color: #f87171;
        --muted-color: #a1a1aa;
        --accent-color: #c084fc;

        /* è‡ªåŠ¨è®¡ç®—çš„é€æ˜åº¦é¢œè‰²ï¼ˆè¯·å‹¿ä¿®æ”¹ï¼‰ */
        --primary-opacity-10: rgba(49, 58, 61, 0.1);
        --primary-opacity-20: rgba(49, 58, 61, 0.2);
        --primary-opacity-30: rgba(49, 58, 61, 0.3);
        --primary-opacity-40: rgba(49, 58, 61, 0.4);
        --secondary-opacity-10: rgba(235, 215, 215, 0.1);
        --secondary-opacity-20: rgba(235, 215, 215, 0.2);
        --secondary-opacity-30: rgba(235, 215, 215, 0.3);
      }

      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: 'Microsoft YaHei', 'PingFang SC', sans-serif;
        background: linear-gradient(
          135deg,
          var(--primary-color) 0%,
          var(--primary-dark) 50%,
          var(--primary-darker) 100%
        );
        color: var(--secondary-color);
        position: relative;
        overflow-x: hidden;
        padding: 20px 0;
      }

      .container {
        max-width: 800px;
        margin: 0 auto;
        padding: 20px;
        position: relative;
      }

      /* è£…é¥°æ€§æ˜Ÿæ˜Ÿ */
      .star {
        position: absolute;
        color: var(--secondary-color);
        font-size: 16px;
        opacity: 0.6;
        animation: twinkle 2s infinite;
      }

      .star:nth-child(1) {
        top: 12%;
        left: 8%;
        animation-delay: 0s;
      }
      .star:nth-child(2) {
        top: 22%;
        right: 12%;
        animation-delay: 0.5s;
      }
      .star:nth-child(3) {
        top: 55%;
        left: 6%;
        animation-delay: 1s;
      }
      .star:nth-child(4) {
        bottom: 18%;
        right: 8%;
        animation-delay: 1.5s;
      }

      @keyframes twinkle {
        0%,
        100% {
          opacity: 0.3;
        }
        50% {
          opacity: 0.8;
        }
      }

      /* CSSå›¾æ ‡æ ·å¼ */
      .crown-icon {
        display: inline-block;
        width: 16px;
        height: 16px;
        margin-right: 8px;
        position: relative;
      }

      .crown-icon::before {
        content: '';
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        width: 14px;
        height: 10px;
        border: 2px solid var(--secondary-color);
        border-bottom: 3px solid var(--secondary-color);
        border-radius: 2px 2px 0 0;
      }

      .crown-icon::after {
        content: '';
        position: absolute;
        top: 30%;
        left: 50%;
        transform: translateX(-50%);
        width: 0;
        height: 0;
        border-left: 4px solid transparent;
        border-right: 4px solid transparent;
        border-bottom: 6px solid var(--secondary-color);
      }

      .dice-icon {
        display: inline-block;
        margin-left: 8px;
        font-size: 16px;
        color: var(--secondary-color);
        cursor: pointer;
        opacity: 0.7;
        transition: opacity 0.3s;
      }

      .dice-icon:hover {
        opacity: 1;
      }

      .edit-icon {
        display: inline-block;
        margin-left: 5px;
        font-size: 16px;
        color: var(--secondary-color);
        cursor: pointer;
        opacity: 0.7;
        transition: opacity 0.3s;
      }

      .edit-icon:hover {
        opacity: 1;
      }

      .main-panel {
        background: rgba(49, 58, 61, var(--panel-bg-opacity));
        border: 2px solid var(--secondary-color);
        border-radius: 20px;
        padding: 25px;
        box-shadow: 0 0 30px var(--secondary-opacity-30);
        backdrop-filter: blur(10px);
      }

      .title {
        text-align: center;
        font-size: 28px;
        font-weight: bold;
        margin-bottom: 15px;
        text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
        background: linear-gradient(45deg, var(--secondary-color), #fff);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
      }

      .subtitle {
        font-size: 14px;
        line-height: 1.6;
        text-align: center;
        margin-bottom: 20px;
        opacity: 0.9;
        padding: 0 10px;
      }

      .form-section {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 15px;
        margin-bottom: 20px;
      }

      .form-group {
        display: flex;
        flex-direction: column;
      }

      .form-group.full-width {
        grid-column: 1 / -1;
      }

      .form-label {
        display: flex;
        align-items: center;
        margin-bottom: 5px;
        font-size: 14px;
        font-weight: bold;
      }

      .form-label .icon {
        margin-left: 8px;
        cursor: pointer;
        opacity: 0.7;
        font-size: 16px;
      }

      .form-label .icon:hover {
        opacity: 1;
      }

      .form-input,
      .form-select {
        padding: 8px 12px;
        border: 1px solid var(--secondary-color);
        border-radius: 8px;
        background: rgba(49, 58, 61, 0.8);
        color: var(--secondary-color);
        font-size: 14px;
      }

      .form-input:focus,
      .form-select:focus {
        outline: none;
        border-color: #fff;
        box-shadow: 0 0 8px var(--secondary-opacity-30);
      }

      .custom-input {
        display: none;
        margin-top: 5px;
      }

      .custom-input.show {
        display: block;
      }

      .options-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
        gap: 8px;
        margin-top: 5px;
      }

      .option-btn {
        padding: 6px 10px;
        border: 1px solid var(--secondary-color);
        border-radius: 15px;
        background: rgba(49, 58, 61, 0.8);
        color: var(--secondary-color);
        font-size: 12px;
        cursor: pointer;
        text-align: center;
        transition: all 0.3s;
      }

      .option-btn.selected {
        background: var(--secondary-color);
        color: var(--primary-color);
        font-weight: bold;
      }

      .option-btn:hover {
        background: var(--secondary-opacity-20);
      }

      .bottom-actions {
        display: flex;
        justify-content: center;
        gap: 20px;
        margin-top: 20px;
      }

      .action-btn {
        padding: 12px 25px;
        border: 2px solid var(--secondary-color);
        border-radius: 25px;
        background: rgba(49, 58, 61, 0.8);
        color: var(--secondary-color);
        font-size: 16px;
        font-weight: bold;
        cursor: pointer;
        transition: all 0.3s;
        display: flex;
        align-items: center;
        gap: 8px;
      }

      .action-btn:hover {
        background: var(--secondary-color);
        color: var(--primary-color);
        transform: translateY(-2px);
        box-shadow: 0 5px 15px var(--secondary-opacity-30);
      }

      .action-btn.primary {
        background: linear-gradient(45deg, var(--secondary-color), #fff);
        color: var(--primary-color);
      }

      .action-btn.primary:hover {
        background: linear-gradient(45deg, #fff, var(--secondary-color));
      }

      .completion-text {
        text-align: center;
        margin-top: 15px;
        font-size: 14px;
        opacity: 0.8;
      }

      .top-actions {
        margin-bottom: 20px;
        margin-top: 10px;
      }

      /* è°ƒæ•´å…¶ä»–è‡ªå®šä¹‰è¾“å…¥æ¡†å®½åº¦ */
      .other-custom-section .form-input {
        width: 100%;
      }

      /* æŠ˜å é€‰é¡¹æ ·å¼ */
      .collapsible-section {
        margin-bottom: 15px;
      }

      .collapsible-header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        cursor: pointer;
        padding: 8px 12px;
        border: 1px solid var(--secondary-color);
        border-radius: 8px;
        background: rgba(49, 58, 61, 0.8);
        margin-bottom: 5px;
        transition: all 0.3s;
      }

      .collapsible-header:hover {
        background: var(--secondary-opacity-10);
      }

      .collapsible-header.collapsed .expand-icon {
        transform: rotate(-90deg);
      }

      .expand-icon {
        font-size: 14px;
        color: var(--secondary-color);
        transition: transform 0.3s;
      }

      .collapsible-content {
        max-height: 500px;
        overflow-y: auto;
        overflow-x: hidden;
        transition: max-height 0.3s ease-out;
      }

      .collapsible-content.collapsed {
        max-height: 0;
        overflow: hidden;
      }

      .selected-items {
        display: none;
        flex-wrap: wrap;
        gap: 5px;
        margin-top: 5px;
      }

      .selected-items.show {
        display: flex;
      }

      .selected-item {
        padding: 3px 8px;
        background: var(--secondary-color);
        color: var(--primary-color);
        border-radius: 10px;
        font-size: 11px;
        font-weight: bold;
      }

      /* å•é€‰æ¨¡å¼æ ·å¼ */
      .single-select .option-btn.selected {
        background: linear-gradient(45deg, var(--secondary-color), #fff);
        color: var(--primary-color);
        font-weight: bold;
        box-shadow: 0 2px 8px var(--secondary-opacity-40);
      }

      .single-select .option-btn:not(.selected):hover {
        background: var(--secondary-opacity-10);
      }

      /* ç³»ç»ŸåŸå› é€‰é¡¹æ ·å¼ */
      .system-reason-option {
        display: flex;
        flex-direction: column;
        align-items: flex-start;
        text-align: left;
        padding: 12px 15px;
        min-height: auto;
        line-height: 1.4;
      }

      .system-reason-title {
        font-weight: bold;
        font-size: 14px;
        margin-bottom: 6px;
        color: var(--secondary-color);
      }

      .system-reason-desc {
        font-size: 11px;
        color: var(--secondary-color);
        opacity: 0.8;
        margin-bottom: 6px;
        line-height: 1.3;
      }

      .system-reason-balance {
        font-size: 12px;
        font-weight: bold;
        color: #fff;
        background: var(--secondary-opacity-20);
        padding: 2px 8px;
        border-radius: 8px;
        align-self: flex-end;
      }

      .system-reason-balance.positive {
        color: var(--success-color);
      }

      .system-reason-balance.negative {
        color: var(--error-color);
      }

      .system-reason-balance.zero {
        color: var(--muted-color);
      }

      /* ç³»ç»ŸåŸå› é€‰é¡¹é€‰ä¸­çŠ¶æ€çš„ç‰¹æ®Šæ ·å¼ */
      .system-reason-option.selected {
        border: 2px solid var(--secondary-color);
        box-shadow: 0 4px 12px var(--secondary-opacity-30);
      }

      .system-reason-option.selected .system-reason-title {
        color: #fff;
      }

      .system-reason-option.selected .system-reason-desc {
        opacity: 1;
        color: var(--accent-color);
      }

      .system-reason-option.selected .system-reason-balance {
        background: var(--secondary-opacity-40);
        box-shadow: 0 2px 4px var(--secondary-opacity-20);
      }

      /* å±æ€§åŠ ç‚¹æ ·å¼ */
      .attribute-item {
        display: flex;
        align-items: center;
        margin-bottom: 15px;
        gap: 15px;
      }

      .attribute-label {
        flex: 0 0 100px;
        font-size: 14px;
        font-weight: bold;
        color: var(--secondary-color);
      }

      .attribute-controls {
        flex: 1;
        display: flex;
        align-items: center;
        gap: 10px;
      }

      .attribute-slider {
        flex: 1;
        height: 6px;
        border-radius: 3px;
        background: linear-gradient(to right, var(--secondary-opacity-30), var(--primary-opacity-30));
        outline: none;
        opacity: 0.7;
        transition: opacity 0.2s;
        cursor: pointer;
        -webkit-appearance: none;
        appearance: none;
      }

      .attribute-slider::-webkit-slider-track {
        height: 6px;
        border-radius: 3px;
        background: linear-gradient(to right, var(--secondary-opacity-30), var(--primary-opacity-30));
      }

      .attribute-slider::-moz-range-track {
        height: 6px;
        border-radius: 3px;
        background: linear-gradient(to right, var(--secondary-opacity-30), var(--primary-opacity-30));
        border: none;
      }

      .attribute-slider:hover {
        opacity: 1;
      }

      .attribute-slider::-webkit-slider-thumb {
        appearance: none;
        width: 20px;
        height: 20px;
        border-radius: 50%;
        background: linear-gradient(45deg, var(--secondary-color), #fff);
        cursor: pointer;
        box-shadow: 0 2px 6px var(--secondary-opacity-30);
      }

      .attribute-slider::-moz-range-thumb {
        width: 20px;
        height: 20px;
        border-radius: 50%;
        background: linear-gradient(45deg, var(--secondary-color), #fff);
        cursor: pointer;
        border: none;
        box-shadow: 0 2px 6px var(--secondary-opacity-30);
      }

      .attribute-input {
        width: 50px;
        padding: 4px 8px;
        border: 1px solid var(--secondary-color);
        border-radius: 4px;
        background: rgba(49, 58, 61, 0.8);
        color: var(--secondary-color);
        font-size: 12px;
        text-align: center;
      }

      .attribute-input:focus {
        outline: none;
        border-color: #fff;
        box-shadow: 0 0 4px var(--secondary-opacity-30);
      }

      .attribute-subtitle {
        font-size: 12px;
        color: var(--secondary-color);
        opacity: 0.8;
        margin-bottom: 15px;
        text-align: center;
        font-style: italic;
      }

      /* è¯´æ˜é¡µé¢æ ·å¼ */
      .instruction-panel {
        text-align: center;
        min-height: 600px;
        display: flex;
        flex-direction: column;
        justify-content: center;
        position: relative;
      }

      .instruction-content {
        padding: 20px;
      }

      .important-steps {
        margin-bottom: 40px;
      }

      .step-item {
        display: flex;
        align-items: center;
        justify-content: center;
        margin: 20px 0;
        padding: 15px 25px;
        border-radius: 15px;
        border: 2px solid;
        background: rgba(49, 58, 61, 0.8);
        backdrop-filter: blur(10px);
        transition: all 0.3s ease;
      }

      .step-item.urgent {
        border-color: var(--secondary-color);
        box-shadow: 0 0 20px var(--secondary-opacity-40);
        animation: urgentGlow 2s ease-in-out infinite alternate;
      }

      .step-item.warning {
        border-color: var(--error-color);
        box-shadow: 0 0 15px rgba(248, 113, 113, 0.3);
      }

      @keyframes urgentGlow {
        from {
          box-shadow: 0 0 20px var(--secondary-opacity-40);
        }
        to {
          box-shadow: 0 0 30px var(--primary-opacity-30);
        }
      }

      .step-number {
        width: 35px;
        height: 35px;
        background: linear-gradient(45deg, var(--secondary-color), #fff);
        color: var(--primary-color);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: bold;
        font-size: 18px;
        margin-right: 15px;
        flex-shrink: 0;
      }

      .step-icon {
        font-size: 24px;
        margin-right: 15px;
        flex-shrink: 0;
      }

      .step-text {
        font-size: 16px;
        font-weight: 500;
        color: var(--secondary-color);
        text-align: left;
        line-height: 1.4;
      }

      .step-text strong {
        color: #fff;
        background: linear-gradient(45deg, var(--secondary-color), #fff);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
        font-weight: bold;
        font-size: 18px;
      }

      .thank-you-section {
        margin: 40px 0;
        padding: 25px;
        border: 1px solid var(--secondary-opacity-30);
        border-radius: 15px;
        background: var(--secondary-opacity-10);
      }

      .thank-you-text p {
        margin: 8px 0;
        font-size: 16px;
        color: var(--secondary-color);
        opacity: 0.9;
      }

      .author-signature {
        margin-top: 25px;
        padding-top: 20px;
        border-top: 1px solid var(--secondary-opacity-30);
      }

      .signature-text {
        font-size: 18px;
        font-weight: bold;
        background: linear-gradient(45deg, var(--secondary-color), #fff);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
        text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
      }

      .decoration-stars {
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        pointer-events: none;
        z-index: -1;
      }

      .star-decoration {
        position: absolute;
        font-size: 20px;
        color: var(--secondary-color);
        opacity: 0.6;
        animation: twinkle 3s infinite;
      }

      .star-decoration:nth-child(1) {
        top: 15%;
        left: 10%;
        animation-delay: 0s;
      }

      .star-decoration:nth-child(2) {
        top: 25%;
        right: 15%;
        animation-delay: 0.6s;
      }

      .star-decoration:nth-child(3) {
        top: 60%;
        left: 8%;
        animation-delay: 1.2s;
      }

      .star-decoration:nth-child(4) {
        bottom: 20%;
        right: 12%;
        animation-delay: 1.8s;
      }

      .star-decoration:nth-child(5) {
        bottom: 30%;
        left: 20%;
        animation-delay: 2.4s;
      }

      /* å“åº”å¼è®¾è®¡ */
      @media (max-width: 600px) {
        body {
          padding: 10px 0;
        }

        .container {
          padding: 15px;
        }

        .form-section {
          grid-template-columns: 1fr;
        }

        .bottom-actions,
        .top-actions {
          flex-direction: column;
          align-items: center;
        }

        .options-grid {
          grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
        }

        .attribute-item {
          flex-direction: column;
          align-items: stretch;
          gap: 8px;
        }

        .attribute-label {
          flex: none;
          text-align: center;
        }

        .attribute-controls {
          justify-content: center;
        }

        .system-reason-option {
          margin-bottom: 10px;
        }

        .system-reason-desc {
          font-size: 10px;
          margin-bottom: 4px;
        }

        .system-reason-balance {
          font-size: 11px;
          padding: 1px 6px;
        }

        /* è¯´æ˜é¡µé¢å“åº”å¼ */
        .instruction-panel {
          min-height: 500px;
          padding: 15px;
        }

        .step-item {
          margin: 15px 0;
          padding: 12px 20px;
          flex-direction: column;
          text-align: center;
        }

        .step-number {
          width: 30px;
          height: 30px;
          font-size: 16px;
          margin-right: 0;
          margin-bottom: 8px;
        }

        .step-icon {
          margin-right: 0;
          margin-bottom: 8px;
        }

        .step-text {
          font-size: 14px;
          text-align: center;
        }

        .step-text strong {
          font-size: 16px;
        }

        .thank-you-section {
          margin: 30px 0;
          padding: 20px;
        }

        .signature-text {
          font-size: 16px;
        }
      }

      /* YAMLæ¨¡æ€çª—å£æ ·å¼ */
      .yaml-modal {
        position: fixed;
        z-index: 1000;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0,0,0,0.5);
        backdrop-filter: blur(5px);
      }

      .yaml-modal-content {
        background: var(--panel-bg);
        margin: 5% auto;
        padding: 0;
        border: 2px solid var(--secondary-color);
        border-radius: 20px;
        width: 90%;
        max-width: 800px;
        max-height: 80vh;
        overflow: hidden;
        box-shadow: 0 0 30px var(--secondary-opacity-30);
        backdrop-filter: blur(10px);
      }

      .yaml-modal-header {
        padding: 20px 25px;
        border-bottom: 1px solid var(--secondary-color);
        display: flex;
        justify-content: space-between;
        align-items: center;
        background: rgba(49, 58, 61, var(--panel-bg-opacity));
      }

      .yaml-modal-header h2 {
        margin: 0;
        color: var(--secondary-color);
        font-size: 20px;
        font-weight: bold;
        background: linear-gradient(45deg, var(--secondary-color), #fff);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
      }

      .yaml-modal-close {
        color: var(--secondary-color);
        font-size: 28px;
        font-weight: bold;
        cursor: pointer;
        line-height: 1;
        transition: all 0.3s;
      }

      .yaml-modal-close:hover {
        color: #fff;
        transform: scale(1.1);
      }

      .yaml-modal-body {
        padding: 20px 25px;
        background: rgba(49, 58, 61, var(--panel-bg-opacity));
      }

      #yamlOutput {
        width: 100%;
        height: 400px;
        background: rgba(49, 58, 61, 0.8);
        border: 1px solid var(--secondary-color);
        border-radius: 8px;
        color: var(--secondary-color);
        font-family: 'Courier New', monospace;
        font-size: 14px;
        padding: 15px;
        resize: vertical;
        margin-bottom: 15px;
        line-height: 1.4;
      }

      #yamlOutput:focus {
        outline: none;
        border-color: #fff;
        box-shadow: 0 0 8px var(--secondary-opacity-30);
      }

      .yaml-modal-actions {
        display: flex;
        gap: 15px;
        justify-content: center;
      }

      .yaml-modal-actions .action-btn {
        min-width: 150px;
      }

      /* å“åº”å¼è®¾è®¡ - YAMLæ¨¡æ€çª—å£ */
      @media (max-width: 600px) {
        .yaml-modal-content {
          margin: 10% auto;
          width: 95%;
          max-height: 85vh;
        }

        .yaml-modal-header {
          padding: 15px 20px;
        }

        .yaml-modal-header h2 {
          font-size: 18px;
        }

        .yaml-modal-close {
          font-size: 24px;
        }

        .yaml-modal-body {
          padding: 15px 20px;
        }

        #yamlOutput {
          height: 300px;
          font-size: 12px;
          padding: 10px;
        }

        .yaml-modal-actions {
          flex-direction: column;
          align-items: center;
        }

        .yaml-modal-actions .action-btn {
          width: 100%;
          min-width: auto;
        }
      }

      /* å­—æ®µéªŒè¯é”™è¯¯æ ·å¼ */
      .form-group.error .form-input,
      .form-group.error .form-select {
        border-color: var(--error-color);
        box-shadow: 0 0 8px rgba(248, 113, 113, 0.3);
      }

      .field-error {
        color: var(--error-color);
        font-size: 12px;
        margin-top: 5px;
        display: none;
      }

      .form-group.error .field-error {
        display: block;
      }

      .required-indicator {
        color: var(--error-color);
        margin-left: 2px;
        font-weight: bold;
      }

      /* è¿”å›æŒ‰é’®æ ·å¼ */
      .back-btn {
        position: fixed;
        top: 20px;
        left: 20px;
        background: rgba(49, 58, 61, var(--panel-bg-opacity));
        border: 2px solid var(--secondary-color);
        border-radius: 15px;
        padding: 10px 20px;
        color: var(--secondary-color);
        text-decoration: none;
        font-weight: bold;
        transition: all 0.3s ease;
        backdrop-filter: blur(10px);
        z-index: 1000;
        box-shadow: 0 2px 10px var(--secondary-opacity-20);
      }

      .back-btn:hover {
        background: var(--secondary-color);
        color: var(--primary-color);
        transform: translateX(-5px);
      }

      /* ä¸–ç•ŒèƒŒæ™¯æ˜¾ç¤ºæ ·å¼ */
      .world-header {
        text-align: center;
        margin-bottom: 20px;
        padding: 15px;
        border: 2px solid var(--secondary-color);
        border-radius: 15px;
        background: rgba(49, 58, 61, 0.3);
        backdrop-filter: blur(5px);
      }

      .world-icon {
        font-size: 32px;
        margin-right: 10px;
        filter: drop-shadow(2px 2px 4px rgba(0, 0, 0, 0.3));
      }

      .world-name {
        font-size: 24px;
        font-weight: bold;
        color: var(--secondary-color);
        text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.5);
      }
    </style>
  </head>
  <body>
    <!-- è¿”å›æŒ‰é’® -->
    <a href="index.html" class="back-btn" id="backBtn">â† è¿”å›ä¸–ç•Œé€‰æ‹©</a>
    
    <div class="star">âœ¨</div>
    <div class="star">â­</div>
    <div class="star">âœ¨</div>
    <div class="star">â­</div>

    <div class="container">
      <div class="main-panel">
        <!-- ä¸–ç•ŒèƒŒæ™¯æ˜¾ç¤º -->
        <div class="world-header" id="worldHeader">
          <span class="world-icon" id="worldIcon">ğŸ™ï¸</span>
          <span class="world-name" id="worldName">ç°ä»£éƒ½å¸‚</span>
        </div>
        
        <h1 class="title" id="pageTitle">âœ¨ è§’è‰²ç”Ÿæˆå™¨ âœ¨</h1>

        <!-- é¡¶éƒ¨å¿«æ·æŒ‰é’® -->
        <div class="bottom-actions top-actions">
          <button class="action-btn" onclick="randomizeAll()">ğŸ“š éšæœºç”Ÿæˆå…¨éƒ¨</button>
          <button class="action-btn primary" onclick="confirmCreate()">âœ¨ ç”Ÿæˆè§’è‰²æ•°æ® âœ¨</button>
        </div>

        <!-- åŸºæœ¬ä¿¡æ¯ -->
        <div class="form-section">
          <div class="form-group full-width">
            <div class="form-label">
              <span class="crown-icon"></span>
              æ ¸å¿ƒèº«ä»½ä¿¡æ¯
            </div>
          </div>

          <div class="form-group">
            <div class="form-label">
              å§“å<span class="required-indicator">*</span>
              <span class="icon edit-icon" onclick="editCustom('realName')">ğŸ–‹</span>
            </div>
            <input type="text" class="form-input" id="realName" placeholder="è¾“å…¥ç”¨æˆ·å§“å" />
            <div class="field-error" id="realNameError">è¯·è¾“å…¥å§“åï¼Œè¿™æ˜¯å¿…å¡«é¡¹</div>
            <input type="text" class="form-input custom-input" id="realNameCustom" placeholder="è‡ªå®šä¹‰å§“å" />
          </div>

          <div class="form-group">
            <div class="form-label">
              å¹´é¾„
              <span class="icon dice-icon" onclick="randomizeField('age')">âš…</span>
              <span class="icon edit-icon" onclick="editCustom('age')">ğŸ–‹</span>
            </div>
            <input type="number" class="form-input" id="age" placeholder="è¾“å…¥å¹´é¾„" />
            <input type="text" class="form-input custom-input" id="ageCustom" placeholder="è‡ªå®šä¹‰å¹´é¾„" />
          </div>

          <div class="form-group">
            <div class="form-label">
              ç”Ÿç†æ€§åˆ«
              <span class="icon dice-icon" onclick="randomizeField('biologicalGender')">âš…</span>
              <span class="icon edit-icon" onclick="editCustom('biologicalGender')">ğŸ–‹</span>
            </div>
            <select class="form-select" id="biologicalGender">
              <option value="">é€‰æ‹©æ€§åˆ«</option>
              <option value="å¥³">å¥³</option>
              <option value="ç”·">ç”·</option>
              <option value="æ‰¶å¥¹">æ‰¶å¥¹</option>
              <option value="åŒæ€§">åŒæ€§</option>
              <option value="æ— æ€§">æ— æ€§</option>
            </select>
            <input
              type="text"
              class="form-input custom-input"
              id="biologicalGenderCustom"
              placeholder="è‡ªå®šä¹‰ç”Ÿç†æ€§åˆ«"
            />
          </div>

          <div class="form-group">
            <div class="form-label">
              æ€§å–å‘
              <span class="icon dice-icon" onclick="randomizeField('sexualOrientation')">âš…</span>
              <span class="icon edit-icon" onclick="editCustom('sexualOrientation')">ğŸ–‹</span>
            </div>
            <select class="form-select" id="sexualOrientation">
              <option value="">é€‰æ‹©æ€§å–å‘</option>
              <option value="å¼‚æ€§æ‹">å¼‚æ€§æ‹</option>
              <option value="åŒæ€§æ‹">åŒæ€§æ‹</option>
              <option value="å››çˆ±">å››çˆ±</option>
              <option value="åŒæ€§æ‹">åŒæ€§æ‹</option>
              <option value="æ³›æ€§æ‹">æ³›æ€§æ‹</option>
              <option value="æ— çˆ±è€…">æ— çˆ±è€…</option>
              <option value="æ— æ€§æ‹">æ— æ€§æ‹</option>
            </select>
            <input
              type="text"
              class="form-input custom-input"
              id="sexualOrientationCustom"
              placeholder="è‡ªå®šä¹‰æ€§å–å‘"
            />
          </div>

          <!-- æ­£é¢æ€§æ ¼ -->
          <div class="form-group full-width">
            <div class="collapsible-section" id="positiveTraitsSection">
              <div class="collapsible-header collapsed" onclick="toggleCollapse('positiveTraits')">
                <div>
                  <span>æ­£é¢æ€§æ ¼</span>
                  <span class="icon dice-icon" onclick="event.stopPropagation(); randomizeField('positiveTraits')"
                    >âš…</span
                  >
                  <span class="icon edit-icon" onclick="event.stopPropagation(); editCustom('positiveTraits')">ğŸ–‹</span>
                </div>
                <span class="expand-icon">â–¼</span>
              </div>
              <div class="selected-items" id="positiveTraitsSelected"></div>
              <div class="collapsible-content collapsed" id="positiveTraitsContent">
                <div class="options-grid" id="positiveTraitsGrid">
                  <!-- é€‰é¡¹å°†ç”±JavaScriptåŠ¨æ€ç”Ÿæˆ -->
                </div>
                <input
                  type="text"
                  class="form-input custom-input"
                  id="positiveTraitsCustom"
                  placeholder="è‡ªå®šä¹‰æ­£é¢æ€§æ ¼ï¼ˆç”¨é€—å·åˆ†éš”ï¼‰"
                />
              </div>
            </div>
          </div>

          <!-- è´Ÿé¢æ€§æ ¼ -->
          <div class="form-group full-width">
            <div class="collapsible-section" id="negativeTraitsSection">
              <div class="collapsible-header collapsed" onclick="toggleCollapse('negativeTraits')">
                <div>
                  <span>è´Ÿé¢æ€§æ ¼</span>
                  <span class="icon dice-icon" onclick="event.stopPropagation(); randomizeField('negativeTraits')"
                    >âš…</span
                  >
                  <span class="icon edit-icon" onclick="event.stopPropagation(); editCustom('negativeTraits')">ğŸ–‹</span>
                </div>
                <span class="expand-icon">â–¼</span>
              </div>
              <div class="selected-items" id="negativeTraitsSelected"></div>
              <div class="collapsible-content collapsed" id="negativeTraitsContent">
                <div class="options-grid" id="negativeTraitsGrid">
                  <!-- é€‰é¡¹å°†ç”±JavaScriptåŠ¨æ€ç”Ÿæˆ -->
                </div>
                <input
                  type="text"
                  class="form-input custom-input"
                  id="negativeTraitsCustom"
                  placeholder="è‡ªå®šä¹‰è´Ÿé¢æ€§æ ¼ï¼ˆç”¨é€—å·åˆ†éš”ï¼‰"
                />
              </div>
            </div>
          </div>

          <!-- æ„Ÿæƒ…è§‚ -->
          <div class="form-group full-width">
            <div class="collapsible-section" id="loveViewsSection">
              <div class="collapsible-header collapsed" onclick="toggleCollapse('loveViews')">
                <div>
                  <span>æ„Ÿæƒ…è§‚</span>
                  <span class="icon dice-icon" onclick="event.stopPropagation(); randomizeField('loveViews')">âš…</span>
                  <span class="icon edit-icon" onclick="event.stopPropagation(); editCustom('loveViews')">ğŸ–‹</span>
                </div>
                <span class="expand-icon">â–¼</span>
              </div>
              <div class="selected-items" id="loveViewsSelected"></div>
              <div class="collapsible-content collapsed" id="loveViewsContent">
                <div class="options-grid" id="loveViewsGrid">
                  <!-- é€‰é¡¹å°†ç”±JavaScriptåŠ¨æ€ç”Ÿæˆ -->
                </div>
                <input
                  type="text"
                  class="form-input custom-input"
                  id="loveViewsCustom"
                  placeholder="è‡ªå®šä¹‰æ„Ÿæƒ…è§‚ï¼ˆç”¨é€—å·åˆ†éš”ï¼‰"
                />
              </div>
            </div>
          </div>

          <!-- ç¤¾äº¤é£æ ¼ -->
          <div class="form-group full-width">
            <div class="collapsible-section" id="socialStyleSection">
              <div class="collapsible-header collapsed" onclick="toggleCollapse('socialStyle')">
                <div>
                  <span>ç¤¾äº¤é£æ ¼</span>
                  <span class="icon dice-icon" onclick="event.stopPropagation(); randomizeField('socialStyle')">âš…</span>
                  <span class="icon edit-icon" onclick="event.stopPropagation(); editCustom('socialStyle')">ğŸ–‹</span>
                </div>
                <span class="expand-icon">â–¼</span>
              </div>
              <div class="selected-items" id="socialStyleSelected"></div>
              <div class="collapsible-content collapsed" id="socialStyleContent">
                <div class="options-grid" id="socialStyleGrid">
                  <!-- é€‰é¡¹å°†ç”±JavaScriptåŠ¨æ€ç”Ÿæˆ -->
                </div>
                <input
                  type="text"
                  class="form-input custom-input"
                  id="socialStyleCustom"
                  placeholder="è‡ªå®šä¹‰ç¤¾äº¤é£æ ¼ï¼ˆç”¨é€—å·åˆ†éš”ï¼‰"
                />
              </div>
            </div>
          </div>
        </div>

        <!-- å¤–è²Œè®¾å®š -->
        <div class="form-section">
          <div class="form-group full-width">
            <div class="form-label">
              <span class="crown-icon"></span>
              å¤–è²Œè®¾å®š
            </div>
          </div>

          <div class="form-group">
            <div class="form-label">
              èº«é«˜
              <span class="icon dice-icon" onclick="randomizeField('height')">âš…</span>
              <span class="icon edit-icon" onclick="editCustom('height')">ğŸ–‹</span>
            </div>
            <input type="number" class="form-input" id="height" placeholder="è¾“å…¥èº«é«˜" />
            <div style="font-size: 12px; color: var(--secondary-color); opacity: 0.7; margin-top: 2px">cm</div>
            <input type="text" class="form-input custom-input" id="heightCustom" placeholder="è‡ªå®šä¹‰èº«é«˜" />
          </div>

          <div class="form-group">
            <div class="form-label">
              ä½“é‡
              <span class="icon dice-icon" onclick="randomizeField('weight')">âš…</span>
              <span class="icon edit-icon" onclick="editCustom('weight')">ğŸ–‹</span>
            </div>
            <input type="number" class="form-input" id="weight" placeholder="è¾“å…¥ä½“é‡" />
            <div style="font-size: 12px; color: var(--secondary-color); opacity: 0.7; margin-top: 2px">kg</div>
            <input type="text" class="form-input custom-input" id="weightCustom" placeholder="è‡ªå®šä¹‰ä½“é‡" />
          </div>

          <!-- é¢è²Œ -->
          <div class="form-group full-width">
            <div class="collapsible-section" id="faceSection">
              <div class="collapsible-header collapsed" onclick="toggleCollapse('face')">
                <div>
                  <span>é¢è²Œ</span>
                  <span class="icon dice-icon" onclick="event.stopPropagation(); randomizeField('face')">âš…</span>
                  <span class="icon edit-icon" onclick="event.stopPropagation(); editCustom('face')">ğŸ–‹</span>
                </div>
                <span class="expand-icon">â–¼</span>
              </div>
              <div class="selected-items" id="faceSelected"></div>
              <div class="collapsible-content collapsed" id="faceContent">
                <div class="options-grid" id="faceGrid">
                  <!-- é€‰é¡¹å°†ç”±JavaScriptåŠ¨æ€ç”Ÿæˆ -->
                </div>
                <input
                  type="text"
                  class="form-input custom-input"
                  id="faceCustom"
                  placeholder="è‡ªå®šä¹‰é¢è²Œï¼ˆç”¨é€—å·åˆ†éš”ï¼‰"
                />
              </div>
            </div>
          </div>

          <!-- èº«æ -->
          <div class="form-group full-width">
            <div class="collapsible-section" id="bodySection">
              <div class="collapsible-header collapsed" onclick="toggleCollapse('body')">
                <div>
                  <span>èº«æ</span>
                  <span class="icon dice-icon" onclick="event.stopPropagation(); randomizeField('body')">âš…</span>
                  <span class="icon edit-icon" onclick="event.stopPropagation(); editCustom('body')">ğŸ–‹</span>
                </div>
                <span class="expand-icon">â–¼</span>
              </div>
              <div class="selected-items" id="bodySelected"></div>
              <div class="collapsible-content collapsed" id="bodyContent">
                <div class="options-grid" id="bodyGrid">
                  <!-- é€‰é¡¹å°†ç”±JavaScriptåŠ¨æ€ç”Ÿæˆ -->
                </div>
                <input
                  type="text"
                  class="form-input custom-input"
                  id="bodyCustom"
                  placeholder="è‡ªå®šä¹‰èº«æï¼ˆç”¨é€—å·åˆ†éš”ï¼‰"
                />
              </div>
            </div>
          </div>

          <div class="form-group">
            <div class="form-label">
              è‚¤è‰²
              <span class="icon dice-icon" onclick="randomizeField('skinColor')">âš…</span>
              <span class="icon edit-icon" onclick="editCustom('skinColor')">ğŸ–‹</span>
            </div>
            <select class="form-select" id="skinColor">
              <option value="">é€‰æ‹©è‚¤è‰²</option>
              <option value="å†·ç™½">å†·ç™½</option>
              <option value="æš–ç™½">æš–ç™½</option>
              <option value="åé»„">åé»„</option>
              <option value="å°éº¦è‰²">å°éº¦è‰²</option>
              <option value="èœœç³–è‰²">èœœç³–è‰²</option>
              <option value="æ·±æ£•è‰²">æ·±æ£•è‰²</option>
              <option value="é€æ˜æ„Ÿç™½">é€æ˜æ„Ÿç™½</option>
              <option value="ç—…æ€è‹ç™½">ç—…æ€è‹ç™½</option>
              <option value="é»‘çš®">é»‘çš®</option>
            </select>
            <input type="text" class="form-input custom-input" id="skinColorCustom" placeholder="è‡ªå®šä¹‰è‚¤è‰²" />
          </div>

          <div class="form-group">
            <div class="form-label">
              ç³è‰²
              <span class="icon dice-icon" onclick="randomizeField('eyeColor')">âš…</span>
              <span class="icon edit-icon" onclick="editCustom('eyeColor')">ğŸ–‹</span>
            </div>
            <select class="form-select" id="eyeColor">
              <option value="">é€‰æ‹©ç³è‰²</option>
              <option value="é»‘è‰²">é»‘è‰²</option>
              <option value="ç™½è‰²">ç™½è‰²</option>
              <option value="æ£•è‰²">æ£•è‰²</option>
              <option value="ç°è‰²">ç°è‰²</option>
              <option value="é…’çº¢è‰²">é…’çº¢è‰²</option>
              <option value="äº®çº¢è‰²">äº®çº¢è‰²</option>
              <option value="ç´«è‰²">ç´«è‰²</option>
              <option value="è“è‰²">è“è‰²</option>
              <option value="ç»¿è‰²">ç»¿è‰²</option>
              <option value="é“¶è‰²">é“¶è‰²</option>
              <option value="çƒŸç´«è‰²">çƒŸç´«è‰²</option>
              <option value="æµ…ç´«">æµ…ç´«</option>
              <option value="æµ…ç²‰è‰²">æµ…ç²‰è‰²</option>
              <option value="ç«ç‘°è‰²">ç«ç‘°è‰²</option>
              <option value="é›¾è“ç°">é›¾è“ç°</option>
              <option value="æµ…æµ·è“">æµ…æµ·è“</option>
              <option value="å¢¨ç»¿è‰²">å¢¨ç»¿è‰²</option>
              <option value="ç°ç»¿è‰²">ç°ç»¿è‰²</option>
              <option value="ç°è“è‰²">ç°è“è‰²</option>
              <option value="å¤©è“è‰²">å¤©è“è‰²</option>
            </select>
            <input type="text" class="form-input custom-input" id="eyeColorCustom" placeholder="è‡ªå®šä¹‰ç³è‰²" />
          </div>

          <div class="form-group">
            <div class="form-label">
              é¢éƒ¨ç‰¹å¾
              <span class="icon dice-icon" onclick="randomizeField('facialFeatures')">âš…</span>
              <span class="icon edit-icon" onclick="editCustom('facialFeatures')">ğŸ–‹</span>
            </div>
            <select class="form-select" id="facialFeatures">
              <option value="">é€‰æ‹©é¢éƒ¨ç‰¹å¾</option>
              <option value="å‡¤çœ¼">å‡¤çœ¼</option>
              <option value="åœ†çœ¼">åœ†çœ¼</option>
              <option value="æ¡ƒèŠ±çœ¼">æ¡ƒèŠ±çœ¼</option>
              <option value="å•çœ¼çš®">å•çœ¼çš®</option>
              <option value="å†…åŒ">å†…åŒ</option>
              <option value="ç‹—ç‹—ä¸‹å‚çœ¼">ç‹—ç‹—ä¸‹å‚çœ¼</option>
              <option value="é•¿ç«æ¯›">é•¿ç«æ¯›</option>
              <option value="å¾®ç¬‘å”‡">å¾®ç¬‘å”‡</option>
              <option value="è–„å”‡">è–„å”‡</option>
              <option value="åšå”‡">åšå”‡</option>
              <option value="å°ç¿˜é¼»">å°ç¿˜é¼»</option>
              <option value="é«˜é¼»æ¢">é«˜é¼»æ¢</option>
              <option value="ç¾äººç—£">ç¾äººç—£</option>
              <option value="æ³ªç—£">æ³ªç—£</option>
              <option value="çœ‰å¿ƒç—£">çœ‰å¿ƒç—£</option>
              <option value="é…’çª">é…’çª</option>
              <option value="æ¢¨æ¶¡">æ¢¨æ¶¡</option>
              <option value="é›€æ–‘">é›€æ–‘</option>
              <option value="ç¾äººå°–">ç¾äººå°–</option>
              <option value="å©´å„¿è‚¥">å©´å„¿è‚¥</option>
              <option value="çœ‰æ¯›æœ‰ç–¤">çœ‰æ¯›æœ‰ç–¤</option>
            </select>
            <input type="text" class="form-input custom-input" id="facialFeaturesCustom" placeholder="è‡ªå®šä¹‰é¢éƒ¨ç‰¹å¾" />
          </div>

          <div class="form-group">
            <div class="form-label">
              å‘è‰²
              <span class="icon dice-icon" onclick="randomizeField('hairColor')">âš…</span>
              <span class="icon edit-icon" onclick="editCustom('hairColor')">ğŸ–‹</span>
            </div>
            <select class="form-select" id="hairColor">
              <option value="">é€‰æ‹©å‘è‰²</option>
              <option value="é»‘è‰²">é»‘è‰²</option>
              <option value="ç™½è‰²">ç™½è‰²</option>
              <option value="æ£•è‰²">æ£•è‰²</option>
              <option value="ç«ç‘°é‡‘">ç«ç‘°é‡‘</option>
              <option value="é…’çº¢è‰²">é…’çº¢è‰²</option>
              <option value="äº®çº¢è‰²">äº®çº¢è‰²</option>
              <option value="ç´«è‰²">ç´«è‰²</option>
              <option value="è“è‰²">è“è‰²</option>
              <option value="ç»¿è‰²">ç»¿è‰²</option>
              <option value="å¥¶å¥¶ç°">å¥¶å¥¶ç°</option>
              <option value="é“¶è‰²">é“¶è‰²</option>
              <option value="æ·±ç°è‰²">æ·±ç°è‰²</option>
              <option value="çƒŸç°è‰²">çƒŸç°è‰²</option>
              <option value="æµ…ç´«">æµ…ç´«</option>
              <option value="æµ…ç²‰è‰²">æµ…ç²‰è‰²</option>
              <option value="ç«ç‘°è‰²">ç«ç‘°è‰²</option>
              <option value="é›¾è“ç°">é›¾è“ç°</option>
              <option value="æµ…æµ·è“">æµ…æµ·è“</option>
              <option value="æ¸å˜è‰²">æ¸å˜è‰²</option>
              <option value="æŒ‘æŸ“">æŒ‘æŸ“</option>
              <option value="æŒ‚è€³æŸ“">æŒ‚è€³æŸ“</option>
              <option value="å‘å°¾æŸ“">å‘å°¾æŸ“</option>
            </select>
            <input type="text" class="form-input custom-input" id="hairColorCustom" placeholder="è‡ªå®šä¹‰å‘è‰²" />
          </div>

          <div class="form-group">
            <div class="form-label">
              å‘å‹
              <span class="icon dice-icon" onclick="randomizeField('hairStyle')">âš…</span>
              <span class="icon edit-icon" onclick="editCustom('hairStyle')">ğŸ–‹</span>
            </div>
            <select class="form-select" id="hairStyle">
              <option value="">é€‰æ‹©å‘å‹</option>
              <option value="çŸ­å‘">çŸ­å‘</option>
              <option value="ä¸­é•¿å‘">ä¸­é•¿å‘</option>
              <option value="é•¿å‘">é•¿å‘</option>
              <option value="åŠè‚©é•¿å‘">åŠè‚©é•¿å‘</option>
              <option value="åŠè…°é•¿å‘">åŠè…°é•¿å‘</option>
              <option value="ç›´å‘">ç›´å‘</option>
              <option value="å·å‘">å·å‘</option>
              <option value="æ¿å¯¸">æ¿å¯¸</option>
              <option value="å‰åˆº">å‰åˆº</option>
              <option value="å¾®åˆ†ç¢ç›–">å¾®åˆ†ç¢ç›–</option>
              <option value="èƒŒå¤´">èƒŒå¤´</option>
              <option value="ä¸­åˆ†">ä¸­åˆ†</option>
              <option value="ç‹¼å°¾å‘å‹">ç‹¼å°¾å‘å‹</option>
              <option value="åŠæ‰å‘">åŠæ‰å‘</option>
              <option value="é«˜é©¬å°¾">é«˜é©¬å°¾</option>
              <option value="ä½é©¬å°¾">ä½é©¬å°¾</option>
              <option value="ä¸¸å­å¤´">ä¸¸å­å¤´</option>
              <option value="é•¿ç›´å‘">é•¿ç›´å‘</option>
              <option value="å¤§æ³¢æµªé•¿å‘">å¤§æ³¢æµªé•¿å‘</option>
              <option value="åŒé©¬å°¾">åŒé©¬å°¾</option>
              <option value="å•ä¾§ç¼–å‘">å•ä¾§ç¼–å‘</option>
            </select>
            <input type="text" class="form-input custom-input" id="hairStyleCustom" placeholder="è‡ªå®šä¹‰å‘å‹" />
          </div>

          <div class="form-group">
            <div class="form-label">
              æ—¥å¸¸ç©¿æ­åå¥½
              <span class="icon dice-icon" onclick="randomizeField('dressStyle')">âš…</span>
              <span class="icon edit-icon" onclick="editCustom('dressStyle')">ğŸ–‹</span>
            </div>
            <select class="form-select" id="dressStyle">
              <option value="">é€‰æ‹©ç©¿æ­é£æ ¼</option>
              <option value="æ¸©æŸ”æ·‘å¥³é£">æ¸©æŸ”æ·‘å¥³é£</option>
              <option value="æ´»æ³¼å¯çˆ±é£">æ´»æ³¼å¯çˆ±é£</option>
              <option value="æ³•å¼ä¼˜é›…">æ³•å¼ä¼˜é›…</option>
              <option value="éŸ©ç³»æ½®æµé£">éŸ©ç³»æ½®æµé£</option>
              <option value="éŸ©ç³»å¥³å›¢é£">éŸ©ç³»å¥³å›¢é£</option>
              <option value="æ¬§ç¾ç«è¾£é£">æ¬§ç¾ç«è¾£é£</option>
              <option value="èŒåœºé€šå‹¤é£">èŒåœºé€šå‹¤é£</option>
              <option value="çŸ¥è¯†åˆ†å­é£">çŸ¥è¯†åˆ†å­é£</option>
              <option value="é‚»å®¶ç®€çº¦é£">é‚»å®¶ç®€çº¦é£</option>
              <option value="æ£®ç³»æ–‡è‰º">æ£®ç³»æ–‡è‰º</option>
              <option value="ç®€çº¦ç›ç³»">ç®€çº¦ç›ç³»</option>
              <option value="æ…µæ‡’éšæ€§">æ…µæ‡’éšæ€§</option>
              <option value="çº¯æ¬²é£">çº¯æ¬²é£</option>
              <option value="Y2Kå¤å¤é£">Y2Kå¤å¤é£</option>
              <option value="æ–°ä¸­å¼é£æ ¼">æ–°ä¸­å¼é£æ ¼</option>
              <option value="äºšæ–‡åŒ–è¾£å¦¹é£">äºšæ–‡åŒ–è¾£å¦¹é£</option>
              <option value="æ´›ä¸½å¡”">æ´›ä¸½å¡”</option>
              <option value="é«˜å®šç¤¼æœ">é«˜å®šç¤¼æœ</option>
              <option value="å¥èº«æˆ¿è¿åŠ¨é£">å¥èº«æˆ¿è¿åŠ¨é£</option>
              <option value="æˆ·å¤–æœºèƒ½é£">æˆ·å¤–æœºèƒ½é£</option>
              <option value="ååª›é£">ååª›é£</option>
              <option value="æ€§æ„Ÿå¾¡å§é£">æ€§æ„Ÿå¾¡å§é£</option>
              <option value="éŸ©ç³»ç”·å›¢é£">éŸ©ç³»ç”·å›¢é£</option>
              <option value="é«˜å®šè¥¿è£…">é«˜å®šè¥¿è£…</option>
              <option value="å•†åŠ¡ä¼‘é—²">å•†åŠ¡ä¼‘é—²</option>
              <option value="ç¾å¼ä¼‘é—²">ç¾å¼ä¼‘é—²</option>
              <option value="æ—¥ç³»ä¼‘é—²">æ—¥ç³»ä¼‘é—²</option>
              <option value="ç®€çº¦åŸºç¡€æ¬¾">ç®€çº¦åŸºç¡€æ¬¾</option>
              <option value="è¡—å¤´æ½®æµ">è¡—å¤´æ½®æµ</option>
              <option value="é«˜è¡—é£æ ¼">é«˜è¡—é£æ ¼</option>
              <option value="å˜»å“ˆè¯´å”±">å˜»å“ˆè¯´å”±</option>
              <option value="å·¥è£…é£æ ¼">å·¥è£…é£æ ¼</option>
              <option value="æˆ·å¤–è¿åŠ¨é£">æˆ·å¤–è¿åŠ¨é£</option>
              <option value="é›…ç—ç»…å£«é£">é›…ç—ç»…å£«é£</option>
              <option value="ä¹¦å·æ°”é£æ ¼">ä¹¦å·æ°”é£æ ¼</option>
              <option value="è€é’±é£">è€é’±é£</option>
              <option value="å¤å¤æ¸¯é£">å¤å¤æ¸¯é£</option>
              <option value="ç²¾è‡´å­¦é™¢é£">ç²¾è‡´å­¦é™¢é£</option>
              <option value="å±…å®¶èˆ’é€‚é£">å±…å®¶èˆ’é€‚é£</option>
              <option value="è¡¬è¡£">è¡¬è¡£</option>
              <option value="æ¯›è¡£">æ¯›è¡£</option>
              <option value="åŠå¸¦è£™">åŠå¸¦è£™</option>
              <option value="èƒŒå¿ƒçƒ­è£¤">èƒŒå¿ƒçƒ­è£¤</option>
              <option value="é£è¡£">é£è¡£</option>
            </select>
            <input type="text" class="form-input custom-input" id="dressStyleCustom" placeholder="è‡ªå®šä¹‰ç©¿æ­é£æ ¼" />
          </div>

          <div class="form-group">
            <div class="form-label">
              æ ‡å¿—æ€§é…é¥°
              <span class="icon dice-icon" onclick="randomizeField('accessories')">âš…</span>
              <span class="icon edit-icon" onclick="editCustom('accessories')">ğŸ–‹</span>
            </div>
            <select class="form-select" id="accessories">
              <option value="">é€‰æ‹©é…é¥°</option>
              <option value="æ¡†æ¶çœ¼é•œ">æ¡†æ¶çœ¼é•œ</option>
              <option value="é‡‘å±ç»†æ¡†çœ¼é•œ">é‡‘å±ç»†æ¡†çœ¼é•œ</option>
              <option value="è€³ç¯">è€³ç¯</option>
              <option value="é•¿è€³å ">é•¿è€³å </option>
              <option value="è€³é’‰">è€³é’‰</option>
              <option value="é¡¹é“¾">é¡¹é“¾</option>
              <option value="é‡‘å±é“¾æ¡">é‡‘å±é“¾æ¡</option>
              <option value="æ‰‹è¡¨">æ‰‹è¡¨</option>
              <option value="æˆ’æŒ‡">æˆ’æŒ‡</option>
              <option value="é“¶æˆ’æŒ‡">é“¶æˆ’æŒ‡</option>
              <option value="æ‰‹é“¾">æ‰‹é“¾</option>
              <option value="æ‰‹é•¯">æ‰‹é•¯</option>
              <option value="å”‡é’‰">å”‡é’‰</option>
              <option value="çœ‰é’‰">çœ‰é’‰</option>
              <option value="ä¹³é’‰">ä¹³é’‰</option>
              <option value="èˆŒé’‰">èˆŒé’‰</option>
              <option value="é¢†å¸¦">é¢†å¸¦</option>
              <option value="èƒ¸é’ˆ">èƒ¸é’ˆ</option>
              <option value="è¢–æ‰£">è¢–æ‰£</option>
              <option value="æ£’çƒå¸½">æ£’çƒå¸½</option>
              <option value="æ¸”å¤«å¸½">æ¸”å¤«å¸½</option>
              <option value="å£ç½©">å£ç½©</option>
            </select>
            <input type="text" class="form-input custom-input" id="accessoriesCustom" placeholder="è‡ªå®šä¹‰é…é¥°" />
          </div>
        </div>

        <!-- å…¶ä»–è®¾å®š -->
        <div class="form-section">
          <div class="form-group full-width">
            <div class="form-label">
              <span class="crown-icon"></span>
              å…¶ä»–è®¾å®š
            </div>
          </div>

          <div class="form-group">
            <div class="form-label">
              ç—…ç—‡
              <span class="icon dice-icon" onclick="randomizeField('illness')">âš…</span>
              <span class="icon edit-icon" onclick="editCustom('illness')">ğŸ–‹</span>
            </div>
            <select class="form-select" id="illness">
              <option value="">é€‰æ‹©ç—…ç—‡</option>
              <option value="èƒƒç—…">èƒƒç—…</option>
              <option value="åå¤´ç—›">åå¤´ç—›</option>
              <option value="å¤±çœ ç—‡">å¤±çœ ç—‡</option>
              <option value="æŠ‘éƒç—‡">æŠ‘éƒç—‡</option>
              <option value="ç„¦è™‘ç—‡">ç„¦è™‘ç—‡</option>
              <option value="èºéƒç—‡">èºéƒç—‡</option>
              <option value="PTSD">PTSD</option>
              <option value="æ–¯å¾·å“¥å°”æ‘©ç»¼åˆå¾">æ–¯å¾·å“¥å°”æ‘©ç»¼åˆå¾</option>
              <option value="ADHD">ADHD</option>
              <option value="ç¤¾äº¤ææƒ§ç—‡">ç¤¾äº¤ææƒ§ç—‡</option>
              <option value="å¹½é—­ææƒ§ç—‡">å¹½é—­ææƒ§ç—‡</option>
              <option value="å“®å–˜">å“®å–˜</option>
              <option value="å¿ƒè„ç—…">å¿ƒè„ç—…</option>
              <option value="è¿‡æ•ä½“è´¨">è¿‡æ•ä½“è´¨</option>
              <option value="åŒé£Ÿç—‡">åŒé£Ÿç—‡</option>
              <option value="æš´é£Ÿç—‡">æš´é£Ÿç—‡</option>
              <option value="å¼ºè¿«ç—‡">å¼ºè¿«ç—‡</option>
              <option value="æ´ç™–">æ´ç™–</option>
              <option value="æé«˜">æé«˜</option>
              <option value="è„¸ç›²">è„¸ç›²</option>
              <option value="é€‰æ‹©å›°éš¾ç—‡">é€‰æ‹©å›°éš¾ç—‡</option>
              <option value="äººæ ¼åˆ†è£‚">äººæ ¼åˆ†è£‚</option>
              <option value="æƒ…æ„Ÿéš”ç¦»">æƒ…æ„Ÿéš”ç¦»</option>
              <option value="é‡åº¦è§†åŠ›éšœç¢">é‡åº¦è§†åŠ›éšœç¢</option>
              <option value="çœ¼ç›²">çœ¼ç›²</option>
              <option value="è€³è‹">è€³è‹</option>
              <option value="å“‘å·´">å“‘å·´</option>
              <option value="ä¸‹è‚¢ç˜«ç—ª">ä¸‹è‚¢ç˜«ç—ª</option>
              <option value="å‹ƒèµ·éšœç¢">å‹ƒèµ·éšœç¢</option>
              <option value="æ— æ³•å°„ç²¾">æ— æ³•å°„ç²¾</option>
              <option value="æ€§ç˜¾">æ€§ç˜¾</option>
            </select>
            <input type="text" class="form-input custom-input" id="illnessCustom" placeholder="è‡ªå®šä¹‰ç—…ç—‡" />
          </div>

          <div class="form-group">
            <div class="form-label">
              äººç‰©ç‰¹ç‚¹
              <span class="icon dice-icon" onclick="randomizeField('characterTrait')">âš…</span>
              <span class="icon edit-icon" onclick="editCustom('characterTrait')">ğŸ–‹</span>
            </div>
            <select class="form-select" id="characterTrait">
              <option value="">é€‰æ‹©ç‰¹ç‚¹</option>
              <option value="æ¨çœ¼é•œ">æ¨çœ¼é•œ</option>
              <option value="æ€è€ƒæ—¶ä¼šè½»å’¬ä¸‹å”‡">æ€è€ƒæ—¶ä¼šè½»å’¬ä¸‹å”‡</option>
              <option value="ä¸äººäº¤è°ˆæ—¶èº«ä½“ä¼šå¾®å¾®å‰å€¾">ä¸äººäº¤è°ˆæ—¶èº«ä½“ä¼šå¾®å¾®å‰å€¾</option>
              <option value="æŠŠç©ç‰©å“">æŠŠç©ç‰©å“</option>
              <option value="æŒ‰å¤ªé˜³ç©´">æŒ‰å¤ªé˜³ç©´</option>
              <option value="æ‰‹æ’å…œ">æ‰‹æ’å…œ</option>
              <option value="å£å¤´ç¦…">å£å¤´ç¦…</option>
              <option value="æŠŠ'è°¢è°¢'æŒ‚åœ¨å˜´è¾¹">æŠŠ"è°¢è°¢"æŒ‚åœ¨å˜´è¾¹</option>
              <option value="å–œæ¬¢è¯´å è¯">å–œæ¬¢è¯´å è¯</option>
              <option value="æ¸¯å°è…”">æ¸¯å°è…”</option>
              <option value="åŒ—äº¬è…”">åŒ—äº¬è…”</option>
              <option value="ä¸œåŒ—è¯">ä¸œåŒ—è¯</option>
              <option value="ç²¤è¯­">ç²¤è¯­</option>
              <option value="è¯´è¯æ—¶å–œæ¬¢é…ä¸Šè‚¢ä½“æ¥è§¦">è¯´è¯æ—¶å–œæ¬¢é…ä¸Šè‚¢ä½“æ¥è§¦</option>
            </select>
            <input type="text" class="form-input custom-input" id="characterTraitCustom" placeholder="è‡ªå®šä¹‰ç‰¹ç‚¹" />
          </div>

          <div class="form-group">
            <div class="form-label">
              ä½“å‘³
              <span class="icon dice-icon" onclick="randomizeField('bodyScent')">âš…</span>
              <span class="icon edit-icon" onclick="editCustom('bodyScent')">ğŸ–‹</span>
            </div>
            <select class="form-select" id="bodyScent">
              <option value="">é€‰æ‹©ä½“å‘³</option>
              <option value="æ— ç‰¹æ®Šæ°”å‘³">æ— ç‰¹æ®Šæ°”å‘³</option>
              <option value="æ¸…æ·¡çš„çš‚é¦™">æ¸…æ·¡çš„çš‚é¦™</option>
              <option value="æ¸…çˆ½çš„æ´—è¡£æ¶²å‘³">æ¸…çˆ½çš„æ´—è¡£æ¶²å‘³</option>
              <option value="é˜³å…‰æ™’è¿‡çš„å‘³é“">é˜³å…‰æ™’è¿‡çš„å‘³é“</option>
              <option value="ç‰›å¥¶å‘³">ç‰›å¥¶å‘³</option>
              <option value="å¥¶ç³–å‘³">å¥¶ç³–å‘³</option>
              <option value="æ·¡æ·¡çš„èŠ±é¦™å‘³">æ·¡æ·¡çš„èŠ±é¦™å‘³</option>
              <option value="é›¨åæ£®æ—çš„æ°”æ¯">é›¨åæ£®æ—çš„æ°”æ¯</option>
              <option value="å¸¸ç”¨çš„é¦™æ°´å‘³">å¸¸ç”¨çš„é¦™æ°´å‘³</option>
              <option value="æœ¨è´¨é¦™">æœ¨è´¨é¦™</option>
              <option value="æµ·æ´‹è°ƒé¦™">æµ·æ´‹è°ƒé¦™</option>
              <option value="æŸ‘æ©˜é¦™">æŸ‘æ©˜é¦™</option>
              <option value="è·å°”è’™æ°”æ¯å¼ºçƒˆ">è·å°”è’™æ°”æ¯å¼ºçƒˆ</option>
              <option value="æ±—å‘³">æ±—å‘³</option>
              <option value="çƒŸè‰å‘³">çƒŸè‰å‘³</option>
              <option value="å’–å•¡é¦™">å’–å•¡é¦™</option>
              <option value="èŒ¶é¦™">èŒ¶é¦™</option>
              <option value="æ¶ˆæ¯’æ°´å‘³">æ¶ˆæ¯’æ°´å‘³</option>
              <option value="ä¹¦å¢¨å‘³">ä¹¦å¢¨å‘³</option>
              <option value="å†·å†½çš„ç©ºæ°”å‘³">å†·å†½çš„ç©ºæ°”å‘³</option>
              <option value="ç”œè…»çš„ç³•ç‚¹å‘³">ç”œè…»çš„ç³•ç‚¹å‘³</option>
              <option value="å¾®å¼±çš„è¡€è…¥å‘³">å¾®å¼±çš„è¡€è…¥å‘³</option>
            </select>
            <input type="text" class="form-input custom-input" id="bodyScentCustom" placeholder="è‡ªå®šä¹‰ä½“å‘³" />
          </div>

          <div class="form-group">
            <div class="form-label">
              èº«ä½“æ•æ„Ÿåº¦
              <span class="icon dice-icon" onclick="randomizeField('sensitivity')">âš…</span>
              <span class="icon edit-icon" onclick="editCustom('sensitivity')">ğŸ–‹</span>
            </div>
            <select class="form-select" id="sensitivity">
              <option value="">é€‰æ‹©æ•æ„Ÿåº¦</option>
              <option value="èº«ä½“è¿Ÿé’">èº«ä½“è¿Ÿé’</option>
              <option value="æ™®é€šæ•æ„Ÿ">æ™®é€šæ•æ„Ÿ</option>
              <option value="è¾ƒä¸ºæ•æ„Ÿ">è¾ƒä¸ºæ•æ„Ÿ</option>
              <option value="å¾ˆæ•æ„Ÿ">å¾ˆæ•æ„Ÿ</option>
              <option value="å…¨èº«éƒ½æ˜¯æ•æ„Ÿç‚¹">å…¨èº«éƒ½æ˜¯æ•æ„Ÿç‚¹</option>
              <option value="è½»è§¦å³å¯å”¤èµ·å¿«æ„Ÿ">è½»è§¦å³å¯å”¤èµ·å¿«æ„Ÿ</option>
              <option value="ç—›æ„Ÿä¸å¿«æ„Ÿç•Œé™æ¨¡ç³Š">ç—›æ„Ÿä¸å¿«æ„Ÿç•Œé™æ¨¡ç³Š</option>
              <option value="è§¦ç¢°å°±é«˜æ½®">è§¦ç¢°å°±é«˜æ½®</option>
              <option value="å¤šé‡é«˜æ½®ä½“è´¨">å¤šé‡é«˜æ½®ä½“è´¨</option>
              <option value="æ„Ÿè§‰è¿‡è½½(æ˜“è¢«è¿‡åº¦åˆºæ¿€)">æ„Ÿè§‰è¿‡è½½(æ˜“è¢«è¿‡åº¦åˆºæ¿€)</option>
            </select>
            <input type="text" class="form-input custom-input" id="sensitivityCustom" placeholder="è‡ªå®šä¹‰æ•æ„Ÿåº¦" />
          </div>

          <div class="form-group">
            <div class="form-label">
              è¿‡å¾€æ€§ç»å†
              <span class="icon dice-icon" onclick="randomizeField('sexualHistory')">âš…</span>
              <span class="icon edit-icon" onclick="editCustom('sexualHistory')">ğŸ–‹</span>
            </div>
            <select class="form-select" id="sexualHistory">
              <option value="">é€‰æ‹©æ€§ç»å†</option>
              <option value="æ— æ€§ç»éªŒ">æ— æ€§ç»éªŒ</option>
              <option value="ä»…æœ‰ç†è®ºçŸ¥è¯†">ä»…æœ‰ç†è®ºçŸ¥è¯†</option>
              <option value="ä»…æœ‰ä¸€æ¬¡ç»éªŒ">ä»…æœ‰ä¸€æ¬¡ç»éªŒ</option>
              <option value="ç»éªŒå¾ˆå°‘">ç»éªŒå¾ˆå°‘</option>
              <option value="åªæœ‰å›ºå®šçš„é•¿æœŸä¼´ä¾£">åªæœ‰å›ºå®šçš„é•¿æœŸä¼´ä¾£</option>
              <option value="ç»éªŒé€‚ä¸­">ç»éªŒé€‚ä¸­</option>
              <option value="æœ‰è¿‡æ•°ä½ä¼´ä¾£">æœ‰è¿‡æ•°ä½ä¼´ä¾£</option>
              <option value="ç»éªŒä¸°å¯Œ">ç»éªŒä¸°å¯Œ</option>
              <option value="æ€§è§‚å¿µå¼€æ”¾">æ€§è§‚å¿µå¼€æ”¾</option>
              <option value="æ€§å…³ç³»æ··ä¹±">æ€§å…³ç³»æ··ä¹±</option>
              <option value="æœ‰BDSMç»éªŒ">æœ‰BDSMç»éªŒ</option>
              <option value="ä»…æœ‰åŒæ€§ç»éªŒ">ä»…æœ‰åŒæ€§ç»éªŒ</option>
              <option value="ä»…æœ‰å¼‚æ€§ç»éªŒ">ä»…æœ‰å¼‚æ€§ç»éªŒ</option>
              <option value="åŒæ€§ç»éªŒçš†æœ‰">åŒæ€§ç»éªŒçš†æœ‰</option>
              <option value="æœ‰è¿‡éè‡ªæ„¿æ€§è¡Œä¸º">æœ‰è¿‡éè‡ªæ„¿æ€§è¡Œä¸º</option>
              <option value="æ›¾å«–å¨¼">æ›¾å«–å¨¼</option>
              <option value="å½“è¿‡å¨¼">å½“è¿‡å¨¼</option>
              <option value="æœ‰ä¸ºäº†èµ„æºæˆ–ç›®çš„çš„æ€§ç»å†">æœ‰ä¸ºäº†èµ„æºæˆ–ç›®çš„çš„æ€§ç»å†</option>
              <option value="æ›¾æœ‰ç»éªŒä½†å¾ˆä¹…æ²¡æœ‰æ€§ç”Ÿæ´»">æ›¾æœ‰ç»éªŒä½†å¾ˆä¹…æ²¡æœ‰æ€§ç”Ÿæ´»</option>
            </select>
            <input type="text" class="form-input custom-input" id="sexualHistoryCustom" placeholder="è‡ªå®šä¹‰æ€§ç»å†" />
          </div>

          <div class="form-group">
            <div class="form-label">
              æ€§æ¬²æŒ‡æ•°
              <span class="icon dice-icon" onclick="randomizeField('libido')">âš…</span>
              <span class="icon edit-icon" onclick="editCustom('libido')">ğŸ–‹</span>
            </div>
            <select class="form-select" id="libido">
              <option value="">é€‰æ‹©æ€§æ¬²æŒ‡æ•°</option>
              <option value="ç¦æ¬²">ç¦æ¬²</option>
              <option value="æ— æ€§æ¬²">æ— æ€§æ¬²</option>
              <option value="æä½æ€§æ¬²">æä½æ€§æ¬²</option>
              <option value="ä½äºæ™®é€š">ä½äºæ™®é€š</option>
              <option value="æ™®é€šæ€§æ¬²">æ™®é€šæ€§æ¬²</option>
              <option value="é«˜äºå¹³å‡">é«˜äºå¹³å‡</option>
              <option value="å¼ºçƒˆæ€§æ¬²">å¼ºçƒˆæ€§æ¬²</option>
              <option value="æé«˜æ€§æ¬²">æé«˜æ€§æ¬²</option>
              <option value="æ—¶æ—¶åˆ»åˆ»éƒ½æœ‰æé«˜æ€§æ¬²">æ—¶æ—¶åˆ»åˆ»éƒ½æœ‰æé«˜æ€§æ¬²</option>
            </select>
            <input type="text" class="form-input custom-input" id="libidoCustom" placeholder="è‡ªå®šä¹‰æ€§æ¬²æŒ‡æ•°" />
          </div>

          <!-- æ€§ç™– -->
          <div class="form-group full-width">
            <div class="collapsible-section" id="kinksSection">
              <div class="collapsible-header collapsed" onclick="toggleCollapse('kinks')">
                <div>
                  <span>æ€§ç™–</span>
                  <span class="icon dice-icon" onclick="event.stopPropagation(); randomizeField('kinks')">âš…</span>
                  <span class="icon edit-icon" onclick="event.stopPropagation(); editCustom('kinks')">ğŸ–‹</span>
                </div>
                <span class="expand-icon">â–¼</span>
              </div>
              <div class="selected-items" id="kinksSelected"></div>
              <div class="collapsible-content collapsed" id="kinksContent">
                <div class="options-grid" id="kinksGrid">
                  <div class="option-btn" data-value="æ”¯é…ä»–äºº">æ”¯é…ä»–äºº</div>
                  <div class="option-btn" data-value="æ†ç»‘ä»–äºº">æ†ç»‘ä»–äºº</div>
                  <div class="option-btn" data-value="æŒæ´æˆ–é­æ‰“ä»–äºº">æŒæ´æˆ–é­æ‰“ä»–äºº</div>
                  <div class="option-btn" data-value="è¨€è¯­ç¾è¾±ä»–äºº">è¨€è¯­ç¾è¾±ä»–äºº</div>
                  <div class="option-btn" data-value="ç²¾ç¥æ§åˆ¶">ç²¾ç¥æ§åˆ¶</div>
                  <div class="option-btn" data-value="å‘½ä»¤ä¸æœä»">å‘½ä»¤ä¸æœä»</div>
                  <div class="option-btn" data-value="è®¾è®¡å¹¶æ§åˆ¶æƒ…èŠ‚">è®¾è®¡å¹¶æ§åˆ¶æƒ…èŠ‚</div>
                  <div class="option-btn" data-value="å°†ä¼´ä¾£å½“ä½œå® ç‰©é¥²å…»">å°†ä¼´ä¾£å½“ä½œå® ç‰©é¥²å…»</div>
                  <div class="option-btn" data-value="è®©ä¼´ä¾£å«‰å¦’">è®©ä¼´ä¾£å«‰å¦’</div>
                  <div class="option-btn" data-value="é€šè¿‡ä»»åŠ¡æˆ–è€ƒéªŒæ§åˆ¶ä¼´ä¾£">é€šè¿‡ä»»åŠ¡æˆ–è€ƒéªŒæ§åˆ¶ä¼´ä¾£</div>
                  <div class="option-btn" data-value="å¯¹ä¼´ä¾£è¿›è¡Œèº«ä½“å´‡æ‹œ">å¯¹ä¼´ä¾£è¿›è¡Œèº«ä½“å´‡æ‹œ</div>
                  <div class="option-btn" data-value="å¤ºå–ä¼´ä¾£çš„æ„Ÿå®˜(å¦‚è’™çœ¼)">å¤ºå–ä¼´ä¾£çš„æ„Ÿå®˜(å¦‚è’™çœ¼)</div>
                  <div class="option-btn" data-value="åˆ¶é€ å¹¶æ¬£èµä¼´ä¾£çš„ç—›è‹¦æˆ–å¿«ä¹è¡¨æƒ…">
                    åˆ¶é€ å¹¶æ¬£èµä¼´ä¾£çš„ç—›è‹¦æˆ–å¿«ä¹è¡¨æƒ…
                  </div>
                  <div class="option-btn" data-value="å¯¹ä¼´ä¾£è¿›è¡Œå¼ºåˆ¶é«˜æ½®">å¯¹ä¼´ä¾£è¿›è¡Œå¼ºåˆ¶é«˜æ½®</div>
                  <div class="option-btn" data-value="å†³å®šä¼´ä¾£çš„è¡£ç€">å†³å®šä¼´ä¾£çš„è¡£ç€</div>
                  <div class="option-btn" data-value="åœ¨ä¼´ä¾£èº«ä¸Šç•™ä¸‹å°è®°(å¦‚å»ç—•)">åœ¨ä¼´ä¾£èº«ä¸Šç•™ä¸‹å°è®°(å¦‚å»ç—•)</div>
                  <div class="option-btn" data-value="å®¡é—®å¼å¯¹è¯">å®¡é—®å¼å¯¹è¯</div>
                  <div class="option-btn" data-value="å‰ƒæ¯›">å‰ƒæ¯›</div>
                  <div class="option-btn" data-value="çŒè‚ ">çŒè‚ </div>
                  <div class="option-btn" data-value="ç¦æ­¢é«˜æ½®">ç¦æ­¢é«˜æ½®</div>
                  <div class="option-btn" data-value="è‡£æœäºäºº">è‡£æœäºäºº</div>
                  <div class="option-btn" data-value="è¢«æ†ç»‘">è¢«æ†ç»‘</div>
                  <div class="option-btn" data-value="è¢«æŒæ´æˆ–è¢«é­æ‰“">è¢«æŒæ´æˆ–è¢«é­æ‰“</div>
                  <div class="option-btn" data-value="è¢«è¨€è¯­ç¾è¾±">è¢«è¨€è¯­ç¾è¾±</div>
                  <div class="option-btn" data-value="è¢«ç²¾ç¥æ§åˆ¶">è¢«ç²¾ç¥æ§åˆ¶</div>
                  <div class="option-btn" data-value="å¬ä»å‘½ä»¤ä¸å®‰æ’">å¬ä»å‘½ä»¤ä¸å®‰æ’</div>
                  <div class="option-btn" data-value="æœä»æƒ…èŠ‚å®‰æ’">æœä»æƒ…èŠ‚å®‰æ’</div>
                  <div class="option-btn" data-value="ä½œä¸ºå® ç‰©è¢«é¥²å…»">ä½œä¸ºå® ç‰©è¢«é¥²å…»</div>
                  <div class="option-btn" data-value="ä¸ºä¼´ä¾£è€Œå«‰å¦’">ä¸ºä¼´ä¾£è€Œå«‰å¦’</div>
                  <div class="option-btn" data-value="é€šè¿‡å®Œæˆä»»åŠ¡è·å¾—å¥–èµ">é€šè¿‡å®Œæˆä»»åŠ¡è·å¾—å¥–èµ</div>
                  <div class="option-btn" data-value="èº«ä½“è¢«å´‡æ‹œ">èº«ä½“è¢«å´‡æ‹œ</div>
                  <div class="option-btn" data-value="è¢«å‰¥å¤ºæ„Ÿå®˜(å¦‚è¢«è’™çœ¼)">è¢«å‰¥å¤ºæ„Ÿå®˜(å¦‚è¢«è’™çœ¼)</div>
                  <div class="option-btn" data-value="è‡ªå·±çš„ç—›è‹¦æˆ–å¿«ä¹è¡¨æƒ…è¢«æ¬£èµ">è‡ªå·±çš„ç—›è‹¦æˆ–å¿«ä¹è¡¨æƒ…è¢«æ¬£èµ</div>
                  <div class="option-btn" data-value="è¢«å¼ºåˆ¶é«˜æ½®">è¢«å¼ºåˆ¶é«˜æ½®</div>
                  <div class="option-btn" data-value="è¢«å†³å®šè¡£ç€">è¢«å†³å®šè¡£ç€</div>
                  <div class="option-btn" data-value="èº«ä¸Šè¢«ç•™ä¸‹å°è®°">èº«ä¸Šè¢«ç•™ä¸‹å°è®°</div>
                  <div class="option-btn" data-value="è¢«å®¡é—®å¼å¯¹è¯">è¢«å®¡é—®å¼å¯¹è¯</div>
                  <div class="option-btn" data-value="è¢«å‰ƒæ¯›">è¢«å‰ƒæ¯›</div>
                  <div class="option-btn" data-value="è¢«çŒè‚ ">è¢«çŒè‚ </div>
                  <div class="option-btn" data-value="è¢«ç¦æ­¢é«˜æ½®">è¢«ç¦æ­¢é«˜æ½®</div>
                  <div class="option-btn" data-value="è§’è‰²æ‰®æ¼”">è§’è‰²æ‰®æ¼”</div>
                  <div class="option-btn" data-value="å¹´é¾„æ‰®æ¼”">å¹´é¾„æ‰®æ¼”</div>
                  <div class="option-btn" data-value="åˆ¶æœè¯±æƒ‘">åˆ¶æœè¯±æƒ‘</div>
                  <div class="option-btn" data-value="æ‹ç‰©(ç‰¹å®šç‰©å“æˆ–æè´¨å¦‚ä¸è¢œ/çš®é©/ä¹³èƒ¶)">
                    æ‹ç‰©(ç‰¹å®šç‰©å“æˆ–æè´¨å¦‚ä¸è¢œ/çš®é©/ä¹³èƒ¶)
                  </div>
                  <div class="option-btn" data-value="æ‹è¶³">æ‹è¶³</div>
                  <div class="option-btn" data-value="æ‹æ‰‹">æ‹æ‰‹</div>
                  <div class="option-btn" data-value="ç–¼ç—›æ¸¸æˆ(ç—›æ„Ÿä¸å¿«æ„Ÿæ¨¡ç³Š)">ç–¼ç—›æ¸¸æˆ(ç—›æ„Ÿä¸å¿«æ„Ÿæ¨¡ç³Š)</div>
                  <div class="option-btn" data-value="åœ¨å…¬å…±æˆ–åŠå…¬å…±åœºæ‰€">åœ¨å…¬å…±æˆ–åŠå…¬å…±åœºæ‰€</div>
                  <div class="option-btn" data-value="æš´éœ²è‡ªå·±çš„èº«ä½“">æš´éœ²è‡ªå·±çš„èº«ä½“</div>
                  <div class="option-btn" data-value="çª¥è§†ä»–äºº">çª¥è§†ä»–äºº</div>
                  <div class="option-btn" data-value="è¢«çª¥è§†">è¢«çª¥è§†</div>
                  <div class="option-btn" data-value="ç”µè¯æˆ–è¯­éŸ³æ€§çˆ±">ç”µè¯æˆ–è¯­éŸ³æ€§çˆ±</div>
                  <div class="option-btn" data-value="å½•åƒæˆ–æ‹ç…§">å½•åƒæˆ–æ‹ç…§</div>
                  <div class="option-btn" data-value="å¤šäººè¡Œ">å¤šäººè¡Œ</div>
                  <div class="option-btn" data-value="NTR(ä¼´ä¾£ä¸ä»–äººå‘ç”Ÿå…³ç³»)">NTR(ä¼´ä¾£ä¸ä»–äººå‘ç”Ÿå…³ç³»)</div>
                  <div class="option-btn" data-value="è¢«NTR">è¢«NTR</div>
                  <div class="option-btn" data-value="ä½“å‹å·®">ä½“å‹å·®</div>
                  <div class="option-btn" data-value="åŠ›é‡å·®">åŠ›é‡å·®</div>
                  <div class="option-btn" data-value="è„è¯">è„è¯</div>
                  <div class="option-btn" data-value="çœ¼æ³ª">çœ¼æ³ª</div>
                  <div class="option-btn" data-value="æ±—æ°´">æ±—æ°´</div>
                  <div class="option-btn" data-value="æ°”å‘³">æ°”å‘³</div>
                  <div class="option-btn" data-value="èœ¡çƒ›æˆ–å†°å—(æ¸©åº¦æ¸¸æˆ)">èœ¡çƒ›æˆ–å†°å—(æ¸©åº¦æ¸¸æˆ)</div>
                  <div class="option-btn" data-value="é£Ÿç‰©(å°†é£Ÿç‰©ç”¨äºèº«ä½“)">é£Ÿç‰©(å°†é£Ÿç‰©ç”¨äºèº«ä½“)</div>
                  <div class="option-btn" data-value="çª’æ¯æ¸¸æˆ(å‘¼å¸æ§åˆ¶)">çª’æ¯æ¸¸æˆ(å‘¼å¸æ§åˆ¶)</div>
                  <div class="option-btn" data-value="æ°´ä¸­å¬‰æˆ">æ°´ä¸­å¬‰æˆ</div>
                  <div class="option-btn" data-value="ç¡çœ ä¾µçŠ¯(åœ¨å¯¹æ–¹ç¡ç€æ—¶)">ç¡çœ ä¾µçŠ¯(åœ¨å¯¹æ–¹ç¡ç€æ—¶)</div>
                  <div class="option-btn" data-value="å£äº¤">å£äº¤</div>
                  <div class="option-btn" data-value="æ‰‹äº¤">æ‰‹äº¤</div>
                  <div class="option-btn" data-value="ä¹³äº¤">ä¹³äº¤</div>
                  <div class="option-btn" data-value="è¶³äº¤">è¶³äº¤</div>
                  <div class="option-btn" data-value="å­å®«äº¤">å­å®«äº¤</div>
                </div>
                <input
                  type="text"
                  class="form-input custom-input"
                  id="kinksCustom"
                  placeholder="è‡ªå®šä¹‰æ€§ç™–ï¼ˆç”¨é€—å·åˆ†éš”ï¼‰"
                />
              </div>
            </div>
          </div>

          <!-- çˆ±å¥½ -->
          <div class="form-group full-width">
            <div class="collapsible-section" id="hobbiesSection">
              <div class="collapsible-header collapsed" onclick="toggleCollapse('hobbies')">
                <div>
                  <span>çˆ±å¥½</span>
                  <span class="icon dice-icon" onclick="event.stopPropagation(); randomizeField('hobbies')">âš…</span>
                  <span class="icon edit-icon" onclick="event.stopPropagation(); editCustom('hobbies')">ğŸ–‹</span>
                </div>
                <span class="expand-icon">â–¼</span>
              </div>
              <div class="selected-items" id="hobbiesSelected"></div>
              <div class="collapsible-content collapsed" id="hobbiesContent">
                <div class="options-grid" id="hobbiesGrid">
                  <div class="option-btn" data-value="é˜…è¯»">é˜…è¯»</div>
                  <div class="option-btn" data-value="ç”µå½±">ç”µå½±</div>
                  <div class="option-btn" data-value="å¬éŸ³ä¹">å¬éŸ³ä¹</div>
                  <div class="option-btn" data-value="åšéŸ³ä¹">åšéŸ³ä¹</div>
                  <div class="option-btn" data-value="å†™ä½œ">å†™ä½œ</div>
                  <div class="option-btn" data-value="ç»˜ç”»">ç»˜ç”»</div>
                  <div class="option-btn" data-value="æ‘„å½±">æ‘„å½±</div>
                  <div class="option-btn" data-value="çƒ¹é¥ª">çƒ¹é¥ª</div>
                  <div class="option-btn" data-value="çƒ˜ç„™">çƒ˜ç„™</div>
                  <div class="option-btn" data-value="è¿åŠ¨">è¿åŠ¨</div>
                  <div class="option-btn" data-value="å¥èº«">å¥èº«</div>
                  <div class="option-btn" data-value="è·‘æ­¥">è·‘æ­¥</div>
                  <div class="option-btn" data-value="æ¸¸æ³³">æ¸¸æ³³</div>
                  <div class="option-btn" data-value="ç¯®çƒ">ç¯®çƒ</div>
                  <div class="option-btn" data-value="è¶³çƒ">è¶³çƒ</div>
                  <div class="option-btn" data-value="æé™è¿åŠ¨">æé™è¿åŠ¨</div>
                  <div class="option-btn" data-value="èˆè¹ˆ">èˆè¹ˆ</div>
                  <div class="option-btn" data-value="ä¹å™¨æ¼”å¥">ä¹å™¨æ¼”å¥</div>
                  <div class="option-btn" data-value="æˆå‰§è¡¨æ¼”">æˆå‰§è¡¨æ¼”</div>
                  <div class="option-btn" data-value="æ—…è¡Œ">æ—…è¡Œ</div>
                  <div class="option-btn" data-value="å¾’æ­¥">å¾’æ­¥</div>
                  <div class="option-btn" data-value="éœ²è¥">éœ²è¥</div>
                  <div class="option-btn" data-value="é’“é±¼">é’“é±¼</div>
                  <div class="option-btn" data-value="å›­è‰º">å›­è‰º</div>
                  <div class="option-btn" data-value="æ‰‹å·¥è‰º">æ‰‹å·¥è‰º</div>
                  <div class="option-btn" data-value="æ¨¡å‹åˆ¶ä½œ">æ¨¡å‹åˆ¶ä½œ</div>
                  <div class="option-btn" data-value="ç”µå­æ¸¸æˆ">ç”µå­æ¸¸æˆ</div>
                  <div class="option-btn" data-value="æ¡Œæ¸¸">æ¡Œæ¸¸</div>
                  <div class="option-btn" data-value="å“èŒ¶">å“èŒ¶</div>
                  <div class="option-btn" data-value="å“é…’">å“é…’</div>
                  <div class="option-btn" data-value="æ”¶è—(é‚®ç¥¨/ç¡¬å¸ç­‰)">æ”¶è—(é‚®ç¥¨/ç¡¬å¸ç­‰)</div>
                  <div class="option-btn" data-value="ç ”ç©¶å†å²">ç ”ç©¶å†å²</div>
                  <div class="option-btn" data-value="ç ”ç©¶å“²å­¦">ç ”ç©¶å“²å­¦</div>
                  <div class="option-btn" data-value="å­¦ä¹ å¤–è¯­">å­¦ä¹ å¤–è¯­</div>
                  <div class="option-btn" data-value="çœ‹åŠ¨æ¼«">çœ‹åŠ¨æ¼«</div>
                  <div class="option-btn" data-value="è¿½å‰§">è¿½å‰§</div>
                  <div class="option-btn" data-value="é€›åšç‰©é¦†">é€›åšç‰©é¦†</div>
                  <div class="option-btn" data-value="å¿—æ„¿è€…æ´»åŠ¨">å¿—æ„¿è€…æ´»åŠ¨</div>
                  <div class="option-btn" data-value="æŠ•èµ„ç†è´¢">æŠ•èµ„ç†è´¢</div>
                  <div class="option-btn" data-value="èµ›è½¦">èµ›è½¦</div>
                  <div class="option-btn" data-value="æ½œæ°´">æ½œæ°´</div>
                  <div class="option-btn" data-value="æ»‘é›ª">æ»‘é›ª</div>
                  <div class="option-btn" data-value="æ€§çˆ±">æ€§çˆ±</div>
                  <div class="option-btn" data-value="è‡ªæ…°">è‡ªæ…°</div>
                </div>
                <input
                  type="text"
                  class="form-input custom-input"
                  id="hobbiesCustom"
                  placeholder="è‡ªå®šä¹‰çˆ±å¥½ï¼ˆç”¨é€—å·åˆ†éš”ï¼‰"
                />
              </div>
            </div>
          </div>

          <!-- æ•æ„Ÿç‚¹ -->
          <div class="form-group full-width">
            <div class="collapsible-section" id="sensitiveSpotsSection">
              <div class="collapsible-header collapsed" onclick="toggleCollapse('sensitiveSpots')">
                <div>
                  <span>æ•æ„Ÿç‚¹</span>
                  <span class="icon dice-icon" onclick="event.stopPropagation(); randomizeField('sensitiveSpots')"
                    >âš…</span
                  >
                  <span class="icon edit-icon" onclick="event.stopPropagation(); editCustom('sensitiveSpots')">ğŸ–‹</span>
                </div>
                <span class="expand-icon">â–¼</span>
              </div>
              <div class="selected-items" id="sensitiveSpotsSelected"></div>
              <div class="collapsible-content collapsed" id="sensitiveSpotsContent">
                <div class="options-grid" id="sensitiveSpotsGrid">
                  <div class="option-btn" data-value="å˜´å”‡">å˜´å”‡</div>
                  <div class="option-btn" data-value="èˆŒå¤´">èˆŒå¤´</div>
                  <div class="option-btn" data-value="è„–é¢ˆ">è„–é¢ˆ</div>
                  <div class="option-btn" data-value="åé¢ˆ">åé¢ˆ</div>
                  <div class="option-btn" data-value="é”éª¨">é”éª¨</div>
                  <div class="option-btn" data-value="è€³å‚">è€³å‚</div>
                  <div class="option-btn" data-value="è„Šæ¤">è„Šæ¤</div>
                  <div class="option-btn" data-value="è…°çª">è…°çª</div>
                  <div class="option-btn" data-value="ä¾§è…°">ä¾§è…°</div>
                  <div class="option-btn" data-value="å°è…¹">å°è…¹</div>
                  <div class="option-btn" data-value="å¤§è…¿å†…ä¾§">å¤§è…¿å†…ä¾§</div>
                  <div class="option-btn" data-value="è„šè¸">è„šè¸</div>
                  <div class="option-btn" data-value="è„šå¿ƒ">è„šå¿ƒ</div>
                  <div class="option-btn" data-value="èƒ¸å£">èƒ¸å£</div>
                  <div class="option-btn" data-value="ä¹³å¤´">ä¹³å¤´</div>
                  <div class="option-btn" data-value="è‚šè„">è‚šè„</div>
                  <div class="option-btn" data-value="è‡€éƒ¨">è‡€éƒ¨</div>
                  <div class="option-btn" data-value="é˜´è’‚">é˜´è’‚</div>
                  <div class="option-btn" data-value="ç©´å£">ç©´å£</div>
                  <div class="option-btn" data-value="Gç‚¹">Gç‚¹</div>
                  <div class="option-btn" data-value="å­å®«å£">å­å®«å£</div>
                  <div class="option-btn" data-value="å­å®«å†…å£">å­å®«å†…å£</div>
                  <div class="option-btn" data-value="åç©´å£">åç©´å£</div>
                  <div class="option-btn" data-value="å‰åˆ—è…º">å‰åˆ—è…º</div>
                  <div class="option-btn" data-value="ç»“è‚ å£">ç»“è‚ å£</div>
                  <div class="option-btn" data-value="é˜´èŒ">é˜´èŒ</div>
                  <div class="option-btn" data-value="é¾Ÿå¤´">é¾Ÿå¤´</div>
                  <div class="option-btn" data-value="é©¬çœ¼">é©¬çœ¼</div>
                  <div class="option-btn" data-value="å°¿é“">å°¿é“</div>
                </div>
                <input
                  type="text"
                  class="form-input custom-input"
                  id="sensitiveSpotsCustom"
                  placeholder="è‡ªå®šä¹‰æ•æ„Ÿç‚¹ï¼ˆç”¨é€—å·åˆ†éš”ï¼‰"
                />
              </div>
            </div>
          </div>
        </div>

        <!-- ç»å† -->
        <div class="form-section">
          <div class="form-group full-width">
            <div class="form-label">
              <span class="crown-icon"></span>
              ç»å†
              <span class="icon dice-icon" onclick="randomizeAllExperience()">âš…</span>
            </div>

            <!-- èº«ä»½ -->
            <div class="collapsible-section" id="identitySection">
              <div class="collapsible-header collapsed" onclick="toggleCollapse('identity')">
                <div>
                  <span>èº«ä»½</span>
                  <span class="icon dice-icon" onclick="event.stopPropagation(); randomizeExperienceField('identity')"
                    >âš…</span
                  >
                  <span class="icon edit-icon" onclick="event.stopPropagation(); editCustom('identity')">ğŸ–‹</span>
                </div>
                <span class="expand-icon">â–¼</span>
              </div>
              <div class="selected-items" id="identitySelected"></div>
              <div class="collapsible-content collapsed" id="identityContent">
                <div class="options-grid single-select" id="identityGrid">
                  <div class="option-btn" data-value="æ˜æ˜Ÿ">æ˜æ˜Ÿ</div>
                  <div class="option-btn" data-value="è±ªé—¨ç»§æ‰¿äºº">è±ªé—¨ç»§æ‰¿äºº</div>
                  <div class="option-btn" data-value="è±ªé—¨ç§ç”Ÿå­">è±ªé—¨ç§ç”Ÿå­</div>
                  <div class="option-btn" data-value="å¤§å­¦ç”Ÿ">å¤§å­¦ç”Ÿ</div>
                  <div class="option-btn" data-value="ç½‘çº¢ä¸»æ’­">ç½‘çº¢ä¸»æ’­</div>
                  <div class="option-btn" data-value="æ¨¡ç‰¹">æ¨¡ç‰¹</div>
                  <div class="option-btn" data-value="æ€»è£">æ€»è£</div>
                  <div class="option-btn" data-value="æŠ•èµ„äºº">æŠ•èµ„äºº</div>
                  <div class="option-btn" data-value="åˆ›ä¸šè€…">åˆ›ä¸šè€…</div>
                  <div class="option-btn" data-value="ç”œç‚¹å¸ˆ">ç”œç‚¹å¸ˆ</div>
                  <div class="option-btn" data-value="å¥èº«æ•™ç»ƒ">å¥èº«æ•™ç»ƒ</div>
                  <div class="option-btn" data-value="å·¥ç¨‹å¸ˆ">å·¥ç¨‹å¸ˆ</div>
                  <div class="option-btn" data-value="æ¸¸æˆç­–åˆ’">æ¸¸æˆç­–åˆ’</div>
                  <div class="option-btn" data-value="åŒ»ç”Ÿ">åŒ»ç”Ÿ</div>
                  <div class="option-btn" data-value="æŠ¤å£«">æŠ¤å£«</div>
                  <div class="option-btn" data-value="èµ›è½¦æ‰‹">èµ›è½¦æ‰‹</div>
                  <div class="option-btn" data-value="æ²¡è½è´µæ—">æ²¡è½è´µæ—</div>
                  <div class="option-btn" data-value="æ£€å¯Ÿå®˜">æ£€å¯Ÿå®˜</div>
                  <div class="option-btn" data-value="é›‡ä½£å…µ">é›‡ä½£å…µ</div>
                  <div class="option-btn" data-value="è­¦å¯Ÿ">è­¦å¯Ÿ</div>
                  <div class="option-btn" data-value="å¾‹å¸ˆ">å¾‹å¸ˆ</div>
                  <div class="option-btn" data-value="ç¨‹åºå‘˜">ç¨‹åºå‘˜</div>
                  <div class="option-btn" data-value="é»‘å®¢">é»‘å®¢</div>
                  <div class="option-btn" data-value="å¯¼æ¼”">å¯¼æ¼”</div>
                  <div class="option-btn" data-value="ç”»å®¶">ç”»å®¶</div>
                  <div class="option-btn" data-value="éŸ³ä¹å®¶">éŸ³ä¹å®¶</div>
                  <div class="option-btn" data-value="è¿åŠ¨å‘˜">è¿åŠ¨å‘˜</div>
                  <div class="option-btn" data-value="ç”µç«é€‰æ‰‹">ç”µç«é€‰æ‰‹</div>
                  <div class="option-btn" data-value="è€å¸ˆ">è€å¸ˆ</div>
                  <div class="option-btn" data-value="è°ƒé…’å¸ˆ">è°ƒé…’å¸ˆ</div>
                  <div class="option-btn" data-value="å¨å¸ˆ">å¨å¸ˆ</div>
                  <div class="option-btn" data-value="ç¾é£Ÿè¯„è®ºå®¶">ç¾é£Ÿè¯„è®ºå®¶</div>
                  <div class="option-btn" data-value="æ—…è¡Œå®¶">æ—…è¡Œå®¶</div>
                  <div class="option-btn" data-value="è€ƒå¤å­¦å®¶">è€ƒå¤å­¦å®¶</div>
                  <div class="option-btn" data-value="æ‘„å½±å¸ˆ">æ‘„å½±å¸ˆ</div>
                  <div class="option-btn" data-value="æ¶ˆé˜²å‘˜">æ¶ˆé˜²å‘˜</div>
                </div>
                <input type="text" class="form-input custom-input" id="identityCustom" placeholder="è‡ªå®šä¹‰èº«ä»½" />
              </div>
            </div>

            <!-- æƒ…æ„ŸçŠ¶æ€ -->
            <div class="collapsible-section" id="relationshipStatusSection">
              <div class="collapsible-header collapsed" onclick="toggleCollapse('relationshipStatus')">
                <div>
                  <span>æƒ…æ„ŸçŠ¶æ€</span>
                  <span
                    class="icon dice-icon"
                    onclick="event.stopPropagation(); randomizeExperienceField('relationshipStatus')"
                    >âš…</span
                  >
                  <span class="icon edit-icon" onclick="event.stopPropagation(); editCustom('relationshipStatus')"
                    >ğŸ–‹</span
                  >
                </div>
                <span class="expand-icon">â–¼</span>
              </div>
              <div class="selected-items" id="relationshipStatusSelected"></div>
              <div class="collapsible-content collapsed" id="relationshipStatusContent">
                <div class="options-grid single-select" id="relationshipStatusGrid">
                  <div class="option-btn" data-value="æ¯èƒå•èº«">æ¯èƒå•èº«</div>
                  <div class="option-btn" data-value="å•èº«">å•èº«</div>
                  <div class="option-btn" data-value="æš—æ‹ä¸­">æš—æ‹ä¸­</div>
                  <div class="option-btn" data-value="åˆšåˆšå¤±æ‹">åˆšåˆšå¤±æ‹</div>
                  <div class="option-btn" data-value="ç¨³å®šæ‹çˆ±ä¸­">ç¨³å®šæ‹çˆ±ä¸­</div>
                  <div class="option-btn" data-value="å·²è®¢å©š">å·²è®¢å©š</div>
                  <div class="option-btn" data-value="ç§˜å¯†å·²å©š">ç§˜å¯†å·²å©š</div>
                  <div class="option-btn" data-value="åˆçº¦å©šå§»">åˆçº¦å©šå§»</div>
                  <div class="option-btn" data-value="å¼€æ”¾å¼å…³ç³»">å¼€æ”¾å¼å…³ç³»</div>
                  <div class="option-btn" data-value="æ­£åœ¨åŠç†ç¦»å©š">æ­£åœ¨åŠç†ç¦»å©š</div>
                  <div class="option-btn" data-value="å·²ç¦»å¼‚">å·²ç¦»å¼‚</div>
                  <div class="option-btn" data-value="ä¸§å¶">ä¸§å¶</div>
                  <div class="option-btn" data-value="ç‚®å‹å…³ç³»">ç‚®å‹å…³ç³»</div>
                  <div class="option-btn" data-value="è¢«å‰ä»»çº ç¼ ">è¢«å‰ä»»çº ç¼ </div>
                  <div class="option-btn" data-value="å¿ƒä¸­æœ‰ç™½æœˆå…‰">å¿ƒä¸­æœ‰ç™½æœˆå…‰</div>
                  <div class="option-btn" data-value="æ¸´æœ›è¢«åŒ…å…»">æ¸´æœ›è¢«åŒ…å…»</div>
                  <div class="option-btn" data-value="æ­£åœ¨åŒ…å…»ä»–äºº">æ­£åœ¨åŒ…å…»ä»–äºº</div>
                  <div class="option-btn" data-value="å‡è£…å•èº«">å‡è£…å•èº«</div>
                  <div class="option-btn" data-value="ç‚’cpä¸­">ç‚’cpä¸­</div>
                  <div class="option-btn" data-value="æµ·ç‹">æµ·ç‹</div>
                  <div class="option-btn" data-value="æµ·å">æµ·å</div>
                </div>
                <input
                  type="text"
                  class="form-input custom-input"
                  id="relationshipStatusCustom"
                  placeholder="è‡ªå®šä¹‰æƒ…æ„ŸçŠ¶æ€"
                />
              </div>
            </div>
          </div>
        </div>

        <!-- å…¶ä»–è‡ªå®šä¹‰ -->
        <div class="form-group full-width other-custom-section">
          <div class="form-label">å…¶ä»–è‡ªå®šä¹‰</div>
          <div style="margin-bottom: 10px">
            <div class="form-label" style="margin-bottom: 5px; font-size: 13px">è¡¥å……è¯´æ˜</div>
            <textarea
              class="form-input"
              id="additionalInfo"
              style="min-height: 60px; resize: vertical"
              placeholder="åœ¨è¿™é‡Œæ·»åŠ ä»»ä½•å…¶ä»–æƒ³è¦è¯´æ˜çš„ä¿¡æ¯ï¼Œæ¯”å¦‚ç‰¹æ®Šç»å†ã€çˆ±å¥½ã€ä¹ æƒ¯ç­‰..."
            ></textarea>
          </div>
        </div>

        <!-- åº•éƒ¨æŒ‰é’® -->
        <div class="bottom-actions">
          <button class="action-btn" onclick="randomizeAll()">ğŸ“š éšæœºç”Ÿæˆå…¨éƒ¨</button>
          <button class="action-btn primary" onclick="confirmCreate()">âœ¨ ç”Ÿæˆè§’è‰²æ•°æ® âœ¨</button>
        </div>

        <div class="completion-text">ç”Ÿæˆå®Œæˆåï¼Œæ‚¨å°†è·å¾—å®Œæ•´çš„YAMLæ ¼å¼è§’è‰²æ•°æ®</div>
      </div>

      <!-- è¯´æ˜é¡µé¢ -->
      <div class="main-panel instruction-panel" id="instructionPanel" style="display: none">
        <h1 class="title">âœ¨ ç”Ÿæˆå®Œæˆ âœ¨</h1>

        <div class="instruction-content">
          <div class="important-steps">
            <div class="step-item urgent">
              <div class="step-number">1</div>
              <div class="step-text">è§’è‰²æ•°æ®å·²ç”Ÿæˆå®Œæˆï¼Œæ‚¨å¯ä»¥ <strong>å¤åˆ¶YAMLæ•°æ®</strong> æˆ– <strong>ä¸‹è½½æ–‡ä»¶</strong></div>
            </div>

            <div class="step-item urgent">
              <div class="step-number">2</div>
              <div class="step-text">å°†è§’è‰²æ•°æ®å¯¼å…¥åˆ°æ‚¨éœ€è¦çš„å¹³å°æˆ–å·¥å…·ä¸­ä½¿ç”¨</div>
            </div>

            <div class="step-item warning">
              <div class="step-icon">ğŸ’¡</div>
              <div class="step-text">YAMLæ ¼å¼çš„è§’è‰²æ•°æ®å¯ä»¥åœ¨å„ç§èŠå¤©æœºå™¨äººã€æ¸¸æˆæˆ–åˆ›ä½œå·¥å…·ä¸­ä½¿ç”¨</div>
            </div>
          </div>

          <div class="thank-you-section">
            <div class="thank-you-text">
              <p>æ„Ÿè°¢ä½¿ç”¨é€šç”¨è§’è‰²ç”Ÿæˆå™¨</p>
              <p>å¸Œæœ›è¿™ä¸ªå·¥å…·èƒ½å¤Ÿå¸®åŠ©æ‚¨çš„åˆ›ä½œ</p>
              <p>æ¬¢è¿åé¦ˆä½¿ç”¨ä½“éªŒå’Œæ”¹è¿›å»ºè®®</p>
              <p>è§’è‰²ç”Ÿæˆå™¨å¼€æºå…è´¹ï¼Œç¦æ­¢å•†ç”¨ã€‚</p>
            </div>

            <div class="author-signature">
              <div class="signature-text">åŸºäºåŸç‰ˆä¿®æ”¹ - é€šç”¨è§’è‰²ç”Ÿæˆå™¨</div>
            </div>
          </div>

          <div class="decoration-stars">
            <span class="star-decoration">âœ¨</span>
            <span class="star-decoration">â­</span>
            <span class="star-decoration">âœ¨</span>
            <span class="star-decoration">â­</span>
            <span class="star-decoration">âœ¨</span>
          </div>
        </div>
      </div>
    </div>

    <!-- YAMLç»“æœæ˜¾ç¤ºçª—å£ -->
    <div id="yamlModal" class="yaml-modal" style="display: none;">
      <div class="yaml-modal-content">
        <div class="yaml-modal-header">
          <h2>è§’è‰²æ•°æ® (YAMLæ ¼å¼)</h2>
          <span class="yaml-modal-close">&times;</span>
        </div>
        <div class="yaml-modal-body">
          <textarea id="yamlOutput" readonly></textarea>
          <div class="yaml-modal-actions">
            <button id="copyYamlBtn" class="action-btn">ğŸ“‹ å¤åˆ¶YAML</button>
          </div>
        </div>
      </div>
    </div>

    <script src="js/options-config.js"></script>
    <script src="js/worlds-config.js"></script>
    <script src="js/js-yaml.min.js"></script>
    <script>
      // å…¨å±€å˜é‡
      let currentWorld = 'modern'; // é»˜è®¤ä¸–ç•Œ
      let currentWorldConfig = null;
      
      // ä»URLå‚æ•°è·å–ä¸–ç•ŒèƒŒæ™¯
      function getWorldFromURL() {
        const urlParams = new URLSearchParams(window.location.search);
        const world = urlParams.get('world');
        return world && WORLDS_CONFIG[world] ? world : 'modern';
      }
      
      // åº”ç”¨ä¸–ç•ŒèƒŒæ™¯ä¸»é¢˜
      function applyWorldTheme(worldKey) {
        const world = WORLDS_CONFIG[worldKey];
        if (!world) return;
        
        currentWorld = worldKey;
        currentWorldConfig = world;
        
        // æ›´æ–°CSSå˜é‡
        const root = document.documentElement;
        const colors = world.color;
        
        // è§£æèƒŒæ™¯æ¸å˜ä¸­çš„é¢œè‰²
        const gradientMatch = colors.background.match(/linear-gradient\([^)]+\)/);
        if (gradientMatch) {
          // æå–æ¸å˜ä¸­çš„é¢œè‰²å€¼
          const colorMatches = colors.background.match(/#[a-fA-F0-9]{6}/g);
          if (colorMatches && colorMatches.length >= 3) {
            root.style.setProperty('--primary-color', colorMatches[0]);
            root.style.setProperty('--primary-dark', colorMatches[1]);
            root.style.setProperty('--primary-darker', colorMatches[2]);
            root.style.setProperty('--panel-bg', colorMatches[0]);
          }
        }
        
        root.style.setProperty('--secondary-color', colors.secondary);
        root.style.setProperty('--accent-color', colors.accent);
        
        // æ›´æ–°èƒŒæ™¯
        document.body.style.background = colors.background;
        
        // æ›´æ–°é¡µé¢å…ƒç´ 
        document.getElementById('worldIcon').textContent = world.icon;
        document.getElementById('worldName').textContent = world.name;
        document.getElementById('pageTitle').textContent = `âœ¨ ${world.name} - è§’è‰²ç”Ÿæˆå™¨ âœ¨`;
        
        // æ›´æ–°è£…é¥°æ˜Ÿæ˜Ÿ
        updateDecorations(world.decorations);
        
        // æ›´æ–°é€‰é¡¹é…ç½®
        updateWorldSpecificOptions(worldKey);
      }
      
      // æ›´æ–°è£…é¥°å…ƒç´ 
      function updateDecorations(decorations) {
        const stars = document.querySelectorAll('.star');
        stars.forEach((star, index) => {
          if (decorations[index % decorations.length]) {
            star.textContent = decorations[index % decorations.length];
          }
        });
      }
      
      // æ›´æ–°æ€§åˆ«ç‰¹å®šçš„ä¸‹æ‹‰æ¡†é€‰é¡¹
      function updateGenderSpecificSelects(gender) {
        const world = WORLDS_CONFIG[currentWorld];
        if (!world) return;
        
        const selectMappings = {
          'dressStyle': 'dressStyle',
          'hairStyle': 'hairstyle', 
          'accessories': 'accessories',
          'illness': 'illness',
          'characterTrait': 'specialTraits',
          'bodyScent': 'bodyScent'
        };
        
        Object.keys(selectMappings).forEach(selectId => {
          const configKey = selectMappings[selectId];
          if (world[configKey] && world[configKey].options && world[configKey].genderSpecific) {
            const options = getOptionsForGender(world[configKey].options, gender);
            updateSelectOptions(selectId, options);
          }
        });
      }
      
      // è¾…åŠ©å‡½æ•°ï¼šæ ¹æ®æ€§åˆ«è·å–é€‰é¡¹ï¼ˆç”¨äºä¸‹æ‹‰æ¡†ï¼‰
      function getOptionsForGender(optionsConfig, gender) {
        if (!optionsConfig || typeof optionsConfig !== 'object') {
          return [];
        }
        
        // å¦‚æœoptionsæ˜¯æ•°ç»„ï¼Œç›´æ¥è¿”å›
        if (Array.isArray(optionsConfig)) {
          return optionsConfig;
        }
        
        // å¤„ç†æ€§åˆ«ç‰¹å®šé…ç½®
        const genderKey = GENDER_MAPPING[gender] || null;
        
        // å¦‚æœæ€§åˆ«ä¸ºç©ºã€æœªçŸ¥æˆ–æ˜ å°„ä¸º'all'ï¼Œæ˜¾ç¤ºæ‰€æœ‰é€‰é¡¹ï¼ˆåˆå¹¶å»é‡ï¼‰
        if (!gender || !genderKey || genderKey === 'all') {
          const allOptions = [];
          Object.keys(optionsConfig).forEach(key => {
            if (Array.isArray(optionsConfig[key])) {
              allOptions.push(...optionsConfig[key]);
            }
          });
          // å»é‡å¹¶è¿”å›
          return [...new Set(allOptions)];
        }
        
        // è¿”å›ç‰¹å®šæ€§åˆ«çš„é€‰é¡¹ï¼ŒåŒ…æ‹¬commoné€‰é¡¹
        let specificOptions = [];
        if (optionsConfig[genderKey] && Array.isArray(optionsConfig[genderKey])) {
          specificOptions.push(...optionsConfig[genderKey]);
        }
        if (optionsConfig.common && Array.isArray(optionsConfig.common)) {
          specificOptions.push(...optionsConfig.common);
        }
        
        return [...new Set(specificOptions)];
      }
      
      // æ›´æ–°ä¸–ç•Œç‰¹å®šçš„é€‰é¡¹
      function updateWorldSpecificOptions(worldKey) {
        const world = WORLDS_CONFIG[worldKey];
        if (!world) return;
        
        // å°†ä¸–ç•Œç‰¹å®šé…ç½®è¦†ç›–åˆ°CHARACTER_OPTIONS_CONFIGä¸­
        Object.keys(world).forEach(key => {
          if (typeof world[key] === 'object' && world[key].type) {
            CHARACTER_OPTIONS_CONFIG[key] = world[key];
          }
        });
        
        // æ›´æ–°èº«ä»½é€‰é¡¹
        if (world.identity && world.identity.options) {
          updateSelectOptions('identity', world.identity.options);
        }
        
        // æ›´æ–°å…¶ä»–ä¸‹æ‹‰æ¡†é€‰é¡¹
        const selectMappings = {
          'dressStyle': 'dressStyle',
          'hairStyle': 'hairstyle', 
          'accessories': 'accessories',
          'illness': 'illness',
          'characterTrait': 'specialTraits',
          'bodyScent': 'bodyScent'
        };
        
        Object.keys(selectMappings).forEach(selectId => {
          const configKey = selectMappings[selectId];
          if (world[configKey] && world[configKey].options) {
            // å¤„ç†æ€§åˆ«ç‰¹å®šé€‰é¡¹
            if (world[configKey].genderSpecific) {
              const currentGender = getCurrentGender();
              const options = getOptionsForGender(world[configKey].options, currentGender);
              updateSelectOptions(selectId, options);
            } else {
              updateSelectOptions(selectId, world[configKey].options);
            }
          }
        });
        
        // é‡æ–°åˆå§‹åŒ–æ‰€æœ‰é€‰é¡¹ç»„ä»¥åº”ç”¨æ–°é…ç½®
        initializeAllOptionGroups();
      }
      
      // æ›´æ–°ä¸‹æ‹‰é€‰æ‹©æ¡†é€‰é¡¹
      function updateSelectOptions(selectId, options) {
        const select = document.getElementById(selectId);
        if (!select) return;
        
        // ä¿å­˜å½“å‰é€‰ä¸­çš„å€¼
        const currentValue = select.value;
        
        // æ¸…ç©ºç°æœ‰é€‰é¡¹ï¼ˆä¿ç•™ç¬¬ä¸€ä¸ªç©ºé€‰é¡¹ï¼‰
        const firstOption = select.querySelector('option[value=""]');
        select.innerHTML = '';
        if (firstOption) {
          select.appendChild(firstOption);
        }
        
        // æ·»åŠ æ–°é€‰é¡¹
        options.forEach(option => {
          const optionElement = document.createElement('option');
          optionElement.value = option;
          optionElement.textContent = option;
          select.appendChild(optionElement);
        });
        
        // æ¢å¤é€‰ä¸­çš„å€¼ï¼ˆå¦‚æœè¿˜å­˜åœ¨ï¼‰
        if (options.includes(currentValue)) {
          select.value = currentValue;
        }
      }
      
      // é¡µé¢åˆå§‹åŒ–
      function initializePage() {
        const worldKey = getWorldFromURL();
        applyWorldTheme(worldKey);
      }
      
      // åœ¨é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–
      document.addEventListener('DOMContentLoaded', function() {
        initializePage();
      });
      
      // é€‚é…æ–°ç‰ˆé…ç½®æ–‡ä»¶çš„å…¼å®¹å±‚
      const CHARACTER_OPTIONS_CONFIG = OPTIONS_CONFIG;
      
      // æ€§åˆ«æ˜ å°„é…ç½®ï¼ˆæ–°ç‰ˆé…ç½®æ–‡ä»¶ä¸­æ²¡æœ‰è¿™ä¸ªï¼‰
      const GENDER_MAPPING = {
        'å¥³': 'female',
        'æ‰¶å¥¹': 'all', 
        'ç”·': 'male',
        'åŒæ€§': 'all',
        'æ— æ€§': 'all'
      };

      // å·¥å…·å‡½æ•°ï¼šæ ¹æ®æ€§åˆ«è·å–é€‰é¡¹ï¼ˆé€‚é…æ–°ç‰ˆé…ç½®ç»“æ„ï¼‰
      function getOptionsByGender(fieldName, gender = '') {
        const config = CHARACTER_OPTIONS_CONFIG[fieldName];
        if (!config) return [];
        
        // å¦‚æœä¸æ˜¯æ€§åˆ«ç‰¹å®šçš„é…ç½®ï¼Œç›´æ¥è¿”å›é€‰é¡¹
        if (!config.genderSpecific) {
          return Array.isArray(config.options) ? config.options : [];
        }

        // å¤„ç†æ€§åˆ«ç‰¹å®šé…ç½®
        const genderKey = GENDER_MAPPING[gender] || null;
        
        // å¦‚æœæ€§åˆ«ä¸ºç©ºã€æœªçŸ¥æˆ–æ˜ å°„ä¸º'all'ï¼Œæ˜¾ç¤ºæ‰€æœ‰é€‰é¡¹ï¼ˆåˆå¹¶å»é‡ï¼‰
        if (!gender || !genderKey || genderKey === 'all') {
          const allOptions = [];
          Object.keys(config.options).forEach(key => {
            if (Array.isArray(config.options[key])) {
              allOptions.push(...config.options[key]);
            }
          });
          // å»é‡å¹¶è¿”å›
          return [...new Set(allOptions)];
        }
        
        // å…ˆå°è¯•è·å–æ€§åˆ«ç‰¹å®šé€‰é¡¹
        let options = config.options[genderKey] || [];
        
        // å¦‚æœæ‰¾ä¸åˆ°ç‰¹å®šæ€§åˆ«é€‰é¡¹ï¼Œå°è¯•è·å–é€šç”¨é€‰é¡¹
        if (options.length === 0) {
          options = config.options.common || [];
        }
        
        // å¦‚æœè¿˜æ˜¯ç©ºï¼Œåˆå¹¶æ‰€æœ‰å¯ç”¨é€‰é¡¹ï¼ˆå…¼å®¹æ—§ç‰ˆ "all" æ¦‚å¿µï¼‰
        if (options.length === 0) {
          const allOptions = [];
          Object.keys(config.options).forEach(key => {
            if (Array.isArray(config.options[key])) {
              allOptions.push(...config.options[key]);
            }
          });
          // å»é‡
          options = [...new Set(allOptions)];
        }
        
        return options;
      }

      // å·¥å…·å‡½æ•°ï¼šè·å–éšæœºé€‰é¡¹ï¼ˆé€‚é…æ–°ç‰ˆé…ç½®ï¼‰
      function getRandomOptions(fieldName, gender = '', count = 1) {
        const config = CHARACTER_OPTIONS_CONFIG[fieldName];
        if (!config) return [];
        
        // ä½¿ç”¨é…ç½®ä¸­çš„éšæœºæ•°é‡èŒƒå›´ï¼Œå¦‚æœæ²¡æœ‰æŒ‡å®šåˆ™ä½¿ç”¨ä¼ å…¥çš„count
        let finalCount = count;
        if (config.randomCount) {
          const { min, max } = config.randomCount;
          finalCount = Math.floor(Math.random() * (max - min + 1)) + min;
        }
        
        const options = getOptionsByGender(fieldName, gender);
        if (!Array.isArray(options) || options.length === 0) return [];
        
        const shuffled = [...options].sort(() => 0.5 - Math.random());
        return shuffled.slice(0, Math.min(finalCount, options.length));
      }

      // å·¥å…·å‡½æ•°ï¼šç”Ÿæˆé€‰é¡¹HTMLï¼ˆé€‚é…æ–°ç‰ˆé…ç½®ï¼‰
      function generateOptionsHTML(fieldName, gender = '') {
        const options = getOptionsByGender(fieldName, gender);
        if (!Array.isArray(options) || options.length === 0) return '';
        
        return options.map(option => 
          `<div class="option-btn" data-value="${option}">${option}</div>`
        ).join('\n          ');
      }

      // å·¥å…·å‡½æ•°ï¼šåŠ¨æ€æ›´æ–°é€‰é¡¹ç½‘æ ¼ï¼ˆé€‚é…æ–°ç‰ˆé…ç½®ï¼‰
      function updateOptionsGrid(fieldName, gender = '') {
        const grid = document.getElementById(fieldName + 'Grid');
        if (!grid) return;
        
        const optionsHTML = generateOptionsHTML(fieldName, gender);
        grid.innerHTML = optionsHTML;
        
        // é‡æ–°ç»‘å®šäº‹ä»¶ç›‘å¬å™¨ï¼ˆå¦‚æœéœ€è¦ï¼‰
        updateSelectedItems(fieldName);
      }

      // ç©¿æ­é£æ ¼é€‰é¡¹è·å–å‡½æ•°ï¼ˆæ–°ç‰ˆé…ç½®ä¸­æ²¡æœ‰è¿™ä¸ªç‰¹æ®Šå¤„ç†ï¼‰
      function getDressStyleOptionsByGender(gender) {
        // ç”±äºæ–°ç‰ˆé…ç½®æ²¡æœ‰dressStyleï¼Œæˆ‘ä»¬éœ€è¦ä»ç°æœ‰çš„HTMLä¸­è·å–é€‰é¡¹
        const dressStyleSelect = document.getElementById('dressStyle');
        if (!dressStyleSelect) return [];
        
        const options = Array.from(dressStyleSelect.options)
          .map(option => option.value)
          .filter(value => value && value !== '');
        
        return options;
      }
    </script>
    <script>
      // å­—æ®µéªŒè¯å’Œé”™è¯¯æ˜¾ç¤ºåŠŸèƒ½
      function showFieldError(fieldId, errorMessage) {
        const fieldGroup = document.getElementById(fieldId).closest('.form-group');
        const errorElement = document.getElementById(fieldId + 'Error');
        
        if (fieldGroup) {
          fieldGroup.classList.add('error');
        }
        
        if (errorElement) {
          if (errorMessage) {
            errorElement.textContent = errorMessage;
          }
          errorElement.style.display = 'block';
        }
        
        // æ»šåŠ¨åˆ°é”™è¯¯å­—æ®µ
        document.getElementById(fieldId).scrollIntoView({ 
          behavior: 'smooth', 
          block: 'center' 
        });
      }

      function hideFieldError(fieldId) {
        const fieldGroup = document.getElementById(fieldId).closest('.form-group');
        const errorElement = document.getElementById(fieldId + 'Error');
        
        if (fieldGroup) {
          fieldGroup.classList.remove('error');
        }
        
        if (errorElement) {
          errorElement.style.display = 'none';
        }
      }

      function validateNameField() {
        const realNameInput = document.getElementById('realName');
        const realNameCustomInput = document.getElementById('realNameCustom');
        
        const realName = realNameInput.value.trim();
        const realNameCustom = realNameCustomInput.value.trim();
        
        // æ£€æŸ¥æ˜¯å¦æœ‰ä»»ä½•å½¢å¼çš„å§“åè¾“å…¥
        if (!realName && !realNameCustom) {
          showFieldError('realName', 'è¯·è¾“å…¥å§“åï¼Œè¿™æ˜¯å¿…å¡«é¡¹');
          return false;
        }
        
        // æ£€æŸ¥å§“åé•¿åº¦
        const finalName = realName || realNameCustom;
        if (finalName.length > 50) {
          showFieldError('realName', 'å§“åé•¿åº¦ä¸èƒ½è¶…è¿‡50ä¸ªå­—ç¬¦');
          return false;
        }
        
        hideFieldError('realName');
        return true;
      }

      // é€‰é¡¹æŒ‰é’®ç‚¹å‡»åŠŸèƒ½
      document.querySelectorAll('.options-grid').forEach(grid => {
        grid.addEventListener('click', function (e) {
          // æ‰¾åˆ°è¢«ç‚¹å‡»çš„é€‰é¡¹æŒ‰é’®ï¼ˆè€ƒè™‘åµŒå¥—å…ƒç´ ï¼‰
          let targetBtn = e.target;
          while (targetBtn && !targetBtn.classList.contains('option-btn')) {
            targetBtn = targetBtn.parentElement;
          }

          if (targetBtn && targetBtn.classList.contains('option-btn')) {
            // æ£€æŸ¥æ˜¯å¦ä¸ºå•é€‰æ¨¡å¼
            if (grid.classList.contains('single-select')) {
              // å•é€‰æ¨¡å¼ç‰¹æ®Šå¤„ç†ï¼šå¦‚æœç‚¹å‡»å·²é€‰ä¸­çš„æŒ‰é’®ï¼Œåˆ™å–æ¶ˆé€‰æ‹©
              if (targetBtn.classList.contains('selected')) {
                targetBtn.classList.remove('selected');
                targetBtn.removeAttribute('data-user-selected');

                // ç‰¹æ®Šå¤„ç†ç»‘å®šç³»ç»Ÿçš„åŸå› ï¼Œé‡ç½®è´¦æˆ·ä½™é¢
                if (grid.id === 'systemReasonGrid') {
                  updateAccountBalance(0);
                }
              } else {
                // æ¸…é™¤å…¶ä»–é€‰æ‹©ï¼Œåªé€‰ä¸­å½“å‰é¡¹
                grid.querySelectorAll('.option-btn').forEach(btn => {
                  btn.classList.remove('selected');
                  btn.removeAttribute('data-user-selected');
                });
                targetBtn.classList.add('selected');
                targetBtn.setAttribute('data-user-selected', 'true');

                // ç‰¹æ®Šå¤„ç†ç»‘å®šç³»ç»Ÿçš„åŸå› ï¼Œæ›´æ–°è´¦æˆ·ä½™é¢
                if (grid.id === 'systemReasonGrid') {
                  const balance = targetBtn.getAttribute('data-balance');
                  if (balance !== null) {
                    updateAccountBalance(parseInt(balance));
                  }
                }
              }
            } else {
              // å¤šé€‰æ¨¡å¼ï¼šåˆ‡æ¢é€‰ä¸­çŠ¶æ€
              if (targetBtn.classList.contains('selected')) {
                targetBtn.classList.remove('selected');
                targetBtn.removeAttribute('data-user-selected');
              } else {
                targetBtn.classList.add('selected');
                targetBtn.setAttribute('data-user-selected', 'true');
              }
            }
            updateSelectedItems(grid.id.replace('Grid', ''));
          }
        });
      });

      // æŠ˜å åŠŸèƒ½
      function toggleCollapse(sectionName) {
        const header = document.querySelector(`#${sectionName}Section .collapsible-header`);
        const content = document.querySelector(`#${sectionName}Content`);
        const selectedItems = document.querySelector(`#${sectionName}Selected`);

        header.classList.toggle('collapsed');
        content.classList.toggle('collapsed');

        // å¦‚æœæŠ˜å ä¸”æœ‰é€‰ä¸­é¡¹ï¼Œæ˜¾ç¤ºé€‰ä¸­é¡¹
        if (header.classList.contains('collapsed') && selectedItems.children.length > 0) {
          selectedItems.classList.add('show');
        } else {
          selectedItems.classList.remove('show');
        }
      }

      // æ›´æ–°é€‰ä¸­é¡¹æ˜¾ç¤º
      function updateSelectedItems(sectionName) {
        const grid = document.getElementById(sectionName + 'Grid');
        const selectedContainer = document.getElementById(sectionName + 'Selected');

        if (!grid || !selectedContainer) return;

        const selectedBtns = grid.querySelectorAll('.option-btn.selected');
        const customInput = document.getElementById(sectionName + 'Custom');
        selectedContainer.innerHTML = '';

        // æ˜¾ç¤ºé€‰ä¸­çš„é€‰é¡¹
        selectedBtns.forEach(btn => {
          const item = document.createElement('div');
          item.className = 'selected-item';

          // ç‰¹æ®Šå¤„ç†ç³»ç»ŸåŸå› é€‰é¡¹ï¼Œæ˜¾ç¤ºæ ‡é¢˜è€Œä¸æ˜¯data-value
          if (sectionName === 'systemReason' && btn.classList.contains('system-reason-option')) {
            const titleElement = btn.querySelector('.system-reason-title');
            item.textContent = titleElement ? titleElement.textContent : btn.getAttribute('data-value');
          } else {
            item.textContent = btn.getAttribute('data-value');
          }

          selectedContainer.appendChild(item);
        });

        // æ˜¾ç¤ºè‡ªå®šä¹‰è¾“å…¥çš„å†…å®¹
        if (customInput && customInput.value.trim()) {
          const customItems = customInput.value
            .split(',')
            .map(s => s.trim())
            .filter(s => s);
          customItems.forEach(customValue => {
            const item = document.createElement('div');
            item.className = 'selected-item';
            item.style.backgroundColor = 'var(--accent-color)'; // å¼ºè°ƒè‰²èƒŒæ™¯åŒºåˆ†è‡ªå®šä¹‰è¾“å…¥
            item.textContent = customValue;
            selectedContainer.appendChild(item);
          });
        }

        // æ›´æ–°æŠ˜å çŠ¶æ€æ˜¾ç¤º
        const header = document.querySelector(`#${sectionName}Section .collapsible-header`);
        if (header && header.classList.contains('collapsed')) {
          const hasSelectedItems = selectedBtns.length > 0 || (customInput && customInput.value.trim());
          if (hasSelectedItems) {
            selectedContainer.classList.add('show');
          } else {
            selectedContainer.classList.remove('show');
          }
        }
      }

      // è·å–å½“å‰æ€§åˆ«
      function getCurrentGender() {
        const biologicalGender = document.getElementById('biologicalGender').value;
        return biologicalGender;
      }

      // æ ¹æ®æ€§åˆ«è·å–é¢è²Œé€‰é¡¹èŒƒå›´ï¼ˆä½¿ç”¨é…ç½®ï¼‰
      // æ£€æŸ¥å­—æ®µæ˜¯å¦å·²æœ‰ç”¨æˆ·ä¸»åŠ¨é€‰æ‹©çš„å€¼
      function hasUserValue(fieldName) {
        const element = document.getElementById(fieldName);
        if (element) {
          if (
            element.type === 'number' ||
            element.tagName === 'INPUT' ||
            element.tagName === 'SELECT' ||
            element.tagName === 'TEXTAREA'
          ) {
            return element.value && element.value.trim() !== '' && element.dataset.userSelected === 'true';
          }
        }

        // æ£€æŸ¥å¤šé€‰é€‰é¡¹
        const grid = document.getElementById(fieldName + 'Grid');
        if (grid) {
          const userSelectedBtns = grid.querySelectorAll('.option-btn.selected[data-user-selected="true"]');
          if (userSelectedBtns.length > 0) return true;
        }

        // æ£€æŸ¥è‡ªå®šä¹‰è¾“å…¥
        const customInput = document.getElementById(fieldName + 'Custom');
        if (
          customInput &&
          customInput.value &&
          customInput.value.trim() !== '' &&
          customInput.dataset.userSelected === 'true'
        ) {
          return true;
        }

        return false;
      }

      // æ£€æŸ¥å­—æ®µæ˜¯å¦å·²æœ‰å€¼ï¼ˆä¸åŒºåˆ†ç”¨æˆ·é€‰æ‹©è¿˜æ˜¯éšæœºç”Ÿæˆï¼‰
      function hasValue(fieldName) {
        const element = document.getElementById(fieldName);
        if (element) {
          if (
            element.type === 'number' ||
            element.tagName === 'INPUT' ||
            element.tagName === 'SELECT' ||
            element.tagName === 'TEXTAREA'
          ) {
            return element.value && element.value.trim() !== '';
          }
        }

        // æ£€æŸ¥å¤šé€‰é€‰é¡¹
        const grid = document.getElementById(fieldName + 'Grid');
        if (grid) {
          const selectedBtns = grid.querySelectorAll('.option-btn.selected');
          if (selectedBtns.length > 0) return true;
        }

        // æ£€æŸ¥è‡ªå®šä¹‰è¾“å…¥
        const customInput = document.getElementById(fieldName + 'Custom');
        if (customInput && customInput.value && customInput.value.trim() !== '') {
          return true;
        }

        return false;
      }

      // éšæœºåŒ–å­—æ®µåŠŸèƒ½
      function randomizeField(fieldName, force = false) {
        // å¦‚æœä¸æ˜¯å¼ºåˆ¶æ¨¡å¼ä¸”æœ‰ç”¨æˆ·ä¸»åŠ¨é€‰æ‹©çš„å€¼ï¼Œåˆ™è·³è¿‡
        if (!force && hasUserValue(fieldName)) {
          return;
        }

        const randomData = {
          age: () => Math.floor(Math.random() * 18) + 18, // 18-35å²
          biologicalGender: () => ['å¥³', 'ç”·', 'æ‰¶å¥¹', 'åŒæ€§', 'æ— æ€§'][Math.floor(Math.random() * 5)],
          sexualOrientation: () =>
            ['å¼‚æ€§æ‹', 'åŒæ€§æ‹', 'å››çˆ±', 'åŒæ€§æ‹', 'æ³›æ€§æ‹', 'æ— çˆ±è€…', 'æ— æ€§æ‹'][Math.floor(Math.random() * 7)],
          positiveTraits: () => getRandomOptions('positiveTraits', getCurrentGender(), Math.floor(Math.random() * 3) + 1),
          negativeTraits: () => getRandomOptions('negativeTraits', getCurrentGender(), Math.floor(Math.random() * 3) + 1),
          loveViews: () => getRandomOptions('loveViews', getCurrentGender(), Math.floor(Math.random() * 3) + 1),
          socialStyle: () => getRandomOptions('socialStyle', getCurrentGender(), Math.floor(Math.random() * 3) + 1),
          face: () => getRandomOptions('face', getCurrentGender(), Math.floor(Math.random() * 2) + 1),
          body: () => getRandomOptions('body', getCurrentGender(), Math.floor(Math.random() * 2) + 1),
          skinColor: () =>
            ['å†·ç™½', 'æš–ç™½', 'åé»„', 'å°éº¦è‰²', 'èœœç³–è‰²', 'æ·±æ£•è‰²', 'é€æ˜æ„Ÿç™½', 'ç—…æ€è‹ç™½', 'é»‘çš®'][
              Math.floor(Math.random() * 9)
            ],
          eyeColor: () =>
            [
              'é»‘è‰²',
              'ç™½è‰²',
              'æ£•è‰²',
              'ç°è‰²',
              'é…’çº¢è‰²',
              'äº®çº¢è‰²',
              'ç´«è‰²',
              'è“è‰²',
              'ç»¿è‰²',
              'é“¶è‰²',
              'çƒŸç´«è‰²',
              'æµ…ç´«',
              'æµ…ç²‰è‰²',
              'ç«ç‘°è‰²',
              'é›¾è“ç°',
              'æµ…æµ·è“',
              'å¢¨ç»¿è‰²',
              'ç°ç»¿è‰²',
              'ç°è“è‰²',
              'å¤©è“è‰²',
            ][Math.floor(Math.random() * 20)],
          facialFeatures: () =>
            [
              'å‡¤çœ¼',
              'åœ†çœ¼',
              'æ¡ƒèŠ±çœ¼',
              'å•çœ¼çš®',
              'å†…åŒ',
              'ç‹—ç‹—ä¸‹å‚çœ¼',
              'é•¿ç«æ¯›',
              'å¾®ç¬‘å”‡',
              'è–„å”‡',
              'åšå”‡',
              'å°ç¿˜é¼»',
              'é«˜é¼»æ¢',
              'ç¾äººç—£',
              'æ³ªç—£',
              'çœ‰å¿ƒç—£',
              'é…’çª',
              'æ¢¨æ¶¡',
              'é›€æ–‘',
              'ç¾äººå°–',
              'å©´å„¿è‚¥',
              'çœ‰æ¯›æœ‰ç–¤',
            ][Math.floor(Math.random() * 21)],
          hairColor: () =>
            [
              'é»‘è‰²',
              'ç™½è‰²',
              'æ£•è‰²',
              'ç«ç‘°é‡‘',
              'é…’çº¢è‰²',
              'äº®çº¢è‰²',
              'ç´«è‰²',
              'è“è‰²',
              'ç»¿è‰²',
              'å¥¶å¥¶ç°',
              'é“¶è‰²',
              'æ·±ç°è‰²',
              'çƒŸç°è‰²',
              'æµ…ç´«',
              'æµ…ç²‰è‰²',
              'ç«ç‘°è‰²',
              'é›¾è“ç°',
              'æµ…æµ·è“',
              'æ¸å˜è‰²',
              'æŒ‘æŸ“',
              'æŒ‚è€³æŸ“',
              'å‘å°¾æŸ“',
            ][Math.floor(Math.random() * 22)],
          hairStyle: () =>
            [
              'çŸ­å‘',
              'ä¸­é•¿å‘',
              'é•¿å‘',
              'åŠè‚©é•¿å‘',
              'åŠè…°é•¿å‘',
              'ç›´å‘',
              'å·å‘',
              'æ¿å¯¸',
              'å‰åˆº',
              'å¾®åˆ†ç¢ç›–',
              'èƒŒå¤´',
              'ä¸­åˆ†',
              'ç‹¼å°¾å‘å‹',
              'åŠæ‰å‘',
              'é«˜é©¬å°¾',
              'ä½é©¬å°¾',
              'ä¸¸å­å¤´',
              'é•¿ç›´å‘',
              'å¤§æ³¢æµªé•¿å‘',
              'åŒé©¬å°¾',
              'å•ä¾§ç¼–å‘',
            ][Math.floor(Math.random() * 21)],
          dressStyle: () => {
            const gender = getCurrentGender();
            const styles = getDressStyleOptionsByGender(gender);
            return styles[Math.floor(Math.random() * styles.length)];
          },
          accessories: () => {
            const accessories = [
              'æ¡†æ¶çœ¼é•œ',
              'é‡‘å±ç»†æ¡†çœ¼é•œ',
              'è€³ç¯',
              'é•¿è€³å ',
              'è€³é’‰',
              'é¡¹é“¾',
              'é‡‘å±é“¾æ¡',
              'æ‰‹è¡¨',
              'æˆ’æŒ‡',
              'é“¶æˆ’æŒ‡',
              'æ‰‹é“¾',
              'æ‰‹é•¯',
              'å”‡é’‰',
              'çœ‰é’‰',
              'ä¹³é’‰',
              'èˆŒé’‰',
              'é¢†å¸¦',
              'èƒ¸é’ˆ',
              'è¢–æ‰£',
              'æ£’çƒå¸½',
              'æ¸”å¤«å¸½',
              'å£ç½©',
            ];
            return accessories[Math.floor(Math.random() * accessories.length)];
          },
          illness: () => {
            const illnesses = [
              'èƒƒç—…',
              'åå¤´ç—›',
              'å¤±çœ ç—‡',
              'æŠ‘éƒç—‡',
              'ç„¦è™‘ç—‡',
              'èºéƒç—‡',
              'PTSD',
              'æ–¯å¾·å“¥å°”æ‘©ç»¼åˆå¾',
              'ADHD',
              'ç¤¾äº¤ææƒ§ç—‡',
              'å¹½é—­ææƒ§ç—‡',
              'å“®å–˜',
              'å¿ƒè„ç—…',
              'è¿‡æ•ä½“è´¨',
              'åŒé£Ÿç—‡',
              'æš´é£Ÿç—‡',
              'å¼ºè¿«ç—‡',
              'æ´ç™–',
              'æé«˜',
              'è„¸ç›²',
              'é€‰æ‹©å›°éš¾ç—‡',
              'äººæ ¼åˆ†è£‚',
              'æƒ…æ„Ÿéš”ç¦»',
              'é‡åº¦è§†åŠ›éšœç¢',
              'çœ¼ç›²',
              'è€³è‹',
              'å“‘å·´',
              'ä¸‹è‚¢ç˜«ç—ª',
              'å‹ƒèµ·éšœç¢',
              'æ— æ³•å°„ç²¾',
              'æ€§ç˜¾',
            ];
            return illnesses[Math.floor(Math.random() * illnesses.length)];
          },
          characterTrait: () => {
            const traits = [
              'æ¨çœ¼é•œ',
              'æ€è€ƒæ—¶ä¼šè½»å’¬ä¸‹å”‡',
              'ä¸äººäº¤è°ˆæ—¶èº«ä½“ä¼šå¾®å¾®å‰å€¾',
              'æŠŠç©ç‰©å“',
              'æŒ‰å¤ªé˜³ç©´',
              'æ‰‹æ’å…œ',
              'å£å¤´ç¦…',
              'æŠŠ"è°¢è°¢"æŒ‚åœ¨å˜´è¾¹',
              'å–œæ¬¢è¯´å è¯',
              'æ¸¯å°è…”',
              'åŒ—äº¬è…”',
              'ä¸œåŒ—è¯',
              'ç²¤è¯­',
              'è¯´è¯æ—¶å–œæ¬¢é…ä¸Šè‚¢ä½“æ¥è§¦',
            ];
            return traits[Math.floor(Math.random() * traits.length)];
          },
          bodyScent: () => {
            const scents = [
              'æ— ç‰¹æ®Šæ°”å‘³',
              'æ¸…æ·¡çš„çš‚é¦™',
              'æ¸…çˆ½çš„æ´—è¡£æ¶²å‘³',
              'é˜³å…‰æ™’è¿‡çš„å‘³é“',
              'ç‰›å¥¶å‘³',
              'å¥¶ç³–å‘³',
              'æ·¡æ·¡çš„èŠ±é¦™å‘³',
              'é›¨åæ£®æ—çš„æ°”æ¯',
              'å¸¸ç”¨çš„é¦™æ°´å‘³',
              'æœ¨è´¨é¦™',
              'æµ·æ´‹è°ƒé¦™',
              'æŸ‘æ©˜é¦™',
              'è·å°”è’™æ°”æ¯å¼ºçƒˆ',
              'æ±—å‘³',
              'çƒŸè‰å‘³',
              'å’–å•¡é¦™',
              'èŒ¶é¦™',
              'æ¶ˆæ¯’æ°´å‘³',
              'ä¹¦å¢¨å‘³',
              'å†·å†½çš„ç©ºæ°”å‘³',
              'ç”œè…»çš„ç³•ç‚¹å‘³',
              'å¾®å¼±çš„è¡€è…¥å‘³',
            ];
            return scents[Math.floor(Math.random() * scents.length)];
          },
          sensitivity: () => {
            const levels = [
              'èº«ä½“è¿Ÿé’',
              'æ™®é€šæ•æ„Ÿ',
              'è¾ƒä¸ºæ•æ„Ÿ',
              'å¾ˆæ•æ„Ÿ',
              'å…¨èº«éƒ½æ˜¯æ•æ„Ÿç‚¹',
              'è½»è§¦å³å¯å”¤èµ·å¿«æ„Ÿ',
              'ç—›æ„Ÿä¸å¿«æ„Ÿç•Œé™æ¨¡ç³Š',
              'è§¦ç¢°å°±é«˜æ½®',
              'å¤šé‡é«˜æ½®ä½“è´¨',
              'æ„Ÿè§‰è¿‡è½½(æ˜“è¢«è¿‡åº¦åˆºæ¿€)',
            ];
            return levels[Math.floor(Math.random() * levels.length)];
          },
          sexualHistory: () => {
            const histories = [
              'æ— æ€§ç»éªŒ',
              'ä»…æœ‰ç†è®ºçŸ¥è¯†',
              'ä»…æœ‰ä¸€æ¬¡ç»éªŒ',
              'ç»éªŒå¾ˆå°‘',
              'åªæœ‰å›ºå®šçš„é•¿æœŸä¼´ä¾£',
              'ç»éªŒé€‚ä¸­',
              'æœ‰è¿‡æ•°ä½ä¼´ä¾£',
              'ç»éªŒä¸°å¯Œ',
              'æ€§è§‚å¿µå¼€æ”¾',
              'æ€§å…³ç³»æ··ä¹±',
              'æœ‰BDSMç»éªŒ',
              'ä»…æœ‰åŒæ€§ç»éªŒ',
              'ä»…æœ‰å¼‚æ€§ç»éªŒ',
              'åŒæ€§ç»éªŒçš†æœ‰',
              'æœ‰è¿‡éè‡ªæ„¿æ€§è¡Œä¸º',
              'æ›¾å«–å¨¼',
              'å½“è¿‡å¨¼',
              'æœ‰ä¸ºäº†èµ„æºæˆ–ç›®çš„çš„æ€§ç»å†',
              'æ›¾æœ‰ç»éªŒä½†å¾ˆä¹…æ²¡æœ‰æ€§ç”Ÿæ´»',
            ];
            return histories[Math.floor(Math.random() * histories.length)];
          },
          libido: () => {
            const levels = [
              'ç¦æ¬²',
              'æ— æ€§æ¬²',
              'æä½æ€§æ¬²',
              'ä½äºæ™®é€š',
              'æ™®é€šæ€§æ¬²',
              'é«˜äºå¹³å‡',
              'å¼ºçƒˆæ€§æ¬²',
              'æé«˜æ€§æ¬²',
              'æ—¶æ—¶åˆ»åˆ»éƒ½æœ‰æé«˜æ€§æ¬²',
            ];
            return levels[Math.floor(Math.random() * levels.length)];
          },
          kinks: () => getRandomOptions('kinks', getCurrentGender(), Math.floor(Math.random() * 5) + 1),
          hobbies: () => getRandomOptions('hobbies', getCurrentGender(), Math.floor(Math.random() * 4) + 2),
          sensitiveSpots: () => getRandomOptions('sensitiveSpots', getCurrentGender(), Math.floor(Math.random() * 3) + 2),
        };

        if (randomData[fieldName]) {
          const value = randomData[fieldName]();

          if (Array.isArray(value)) {
            // å¤„ç†å¤šé€‰é€‰é¡¹
            const grid = document.getElementById(fieldName + 'Grid');
            if (grid) {
              // æ¸…é™¤æ‰€æœ‰é€‰æ‹©
              grid.querySelectorAll('.option-btn').forEach(btn => btn.classList.remove('selected'));
              // é€‰æ‹©éšæœºé¡¹
              value.forEach(item => {
                const btn = grid.querySelector(`[data-value="${item}"]`);
                if (btn) btn.classList.add('selected');
              });
              // æ›´æ–°é€‰ä¸­é¡¹æ˜¾ç¤º
              updateSelectedItems(fieldName);
            }
          } else {
            // å¤„ç†å•é€‰é¡¹å’Œæ•°å€¼é¡¹
            const element = document.getElementById(fieldName);
            if (element) {
              element.value = value;
            }
          }
        }

        // ç‰¹æ®Šå¤„ç†èº«é«˜ä½“é‡çš„éšæœºå€¼
        if (fieldName === 'age') {
          const ageElement = document.getElementById('age');
          if (ageElement) {
            ageElement.value = Math.floor(Math.random() * 18) + 18; // 18-35å²
          }
        } else if (fieldName === 'height') {
          const heightElement = document.getElementById('height');
          const gender = getCurrentGender();
          if (heightElement) {
            if (gender === 'å¥³' || gender === 'æ‰¶å¥¹') {
              heightElement.value = Math.floor(Math.random() * 41) + 140; // 140-180cm
            } else if (gender === 'ç”·' || gender === 'åŒæ€§') {
              heightElement.value = Math.floor(Math.random() * 24) + 175; // 175-198cm
            } else {
              heightElement.value = Math.floor(Math.random() * 59) + 140; // 140-198cm
            }
          }
        } else if (fieldName === 'weight') {
          const weightElement = document.getElementById('weight');
          const gender = getCurrentGender();
          if (weightElement) {
            if (gender === 'å¥³' || gender === 'æ‰¶å¥¹') {
              weightElement.value = Math.floor(Math.random() * 21) + 40; // 40-60kg
            } else if (gender === 'ç”·' || gender === 'åŒæ€§') {
              weightElement.value = Math.floor(Math.random() * 21) + 60; // 60-80kg
            } else {
              weightElement.value = Math.floor(Math.random() * 41) + 40; // 40-80kg
            }
          }
        }
      }

      // è·å–éšæœºé¡¹ç›®
      function getRandomItems(array, count) {
        const shuffled = array.sort(() => 0.5 - Math.random());
        return shuffled.slice(0, count);
      }

      // å±æ€§åŠ ç‚¹åŠŸèƒ½
      function updateAttributeInput(attributeName, value) {
        const input = document.getElementById(attributeName + 'Input');
        if (input) {
          input.value = value;
        }
      }

      function updateAttributeSlider(attributeName, value) {
        const slider = document.getElementById(attributeName + 'Slider');
        if (slider) {
          slider.value = Math.max(0, Math.min(100, parseInt(value) || 0));
        }
      }

      function randomizeAttribute(attributeName, force = false) {
        // å¦‚æœä¸æ˜¯å¼ºåˆ¶æ¨¡å¼ä¸”æœ‰ç”¨æˆ·ä¸»åŠ¨é€‰æ‹©çš„å€¼ï¼Œåˆ™è·³è¿‡
        if (!force) {
          const input = document.getElementById(attributeName + 'Input');
          if (
            input &&
            input.value &&
            input.value !== '10' &&
            input.value !== '0' &&
            input.dataset.userSelected === 'true'
          ) {
            return;
          }
        }

        let randomValue;
        if (attributeName === 'reputation') {
          // é£è¯„å€¼çš„éšæœºèŒƒå›´æ˜¯-80åˆ°+80
          randomValue = Math.floor(Math.random() * 161) - 80; // -80 åˆ° +80
        } else {
          // å…¶ä»–å±æ€§çš„éšæœºèŒƒå›´æ˜¯0-100
          randomValue = Math.floor(Math.random() * 101); // 0-100èŒƒå›´
        }

        const slider = document.getElementById(attributeName + 'Slider');
        const input = document.getElementById(attributeName + 'Input');

        if (slider) slider.value = randomValue;
        if (input) input.value = randomValue;
      }

      function randomizeAllAttributes() {
        // å±æ€§åŠ ç‚¹åŠŸèƒ½å·²è¢«ç§»é™¤
        alert('å±æ€§åŠ ç‚¹åŠŸèƒ½å·²è¢«ç§»é™¤');
      }

      function randomizeBasicAttributes() {
        // åŸºç¡€å±æ€§åŠŸèƒ½å·²è¢«ç§»é™¤
        alert('åŸºç¡€å±æ€§åŠŸèƒ½å·²è¢«ç§»é™¤');
      }

      function randomizeAbilityAttributes() {
        // èƒ½åŠ›æ•°å€¼åŠŸèƒ½å·²è¢«ç§»é™¤
        alert('èƒ½åŠ›æ•°å€¼åŠŸèƒ½å·²è¢«ç§»é™¤');
      }

      // è´¦æˆ·ä½™é¢åŠŸèƒ½å·²è¢«ç§»é™¤
      function updateAccountBalance(balance) {
        // åŠŸèƒ½å·²è¢«ç§»é™¤
      }

      // ç»å†éƒ¨åˆ†çš„éšæœºåŒ–
      function randomizeExperienceField(fieldName, force = false) {
        // å¦‚æœä¸æ˜¯å¼ºåˆ¶æ¨¡å¼ä¸”æœ‰ç”¨æˆ·ä¸»åŠ¨é€‰æ‹©çš„å€¼ï¼Œåˆ™è·³è¿‡
        if (!force && hasUserValue(fieldName)) {
          return;
        }
        const experienceData = {
          identity: () => getRandomOptions('identity', getCurrentGender(), 1)[0],

          relationshipStatus: () => getRandomOptions('relationshipStatus', getCurrentGender(), 1)[0],
        };

        const value = experienceData[fieldName]();
        const grid = document.getElementById(fieldName + 'Grid');

        if (grid) {
          // æ¸…é™¤æ‰€æœ‰é€‰æ‹©
          grid.querySelectorAll('.option-btn').forEach(btn => btn.classList.remove('selected'));

          if (fieldName === 'systemReason') {
            // ç‰¹æ®Šå¤„ç†ç»‘å®šç³»ç»Ÿçš„åŸå› 
            const btn = grid.querySelector(`[data-value="${value.value}"]`);
            if (btn) {
              btn.classList.add('selected');
              updateAccountBalance(value.balance);
            }
          } else {
            // é€‰æ‹©éšæœºé¡¹
            const btn = grid.querySelector(`[data-value="${value}"]`);
            if (btn) btn.classList.add('selected');
          }

          // æ›´æ–°é€‰ä¸­é¡¹æ˜¾ç¤º
          updateSelectedItems(fieldName);
        }
      }

      // éšæœºç”Ÿæˆæ‰€æœ‰ç»å†
      function randomizeAllExperience() {
        randomizeExperienceField('identity');
        randomizeExperienceField('relationshipStatus');

        alert('å·²éšæœºç”Ÿæˆæ‰€æœ‰ç»å†ä¿¡æ¯ï¼');
      }

      // ç¼–è¾‘è‡ªå®šä¹‰è¾“å…¥
      function editCustom(fieldName) {
        const customInput = document.getElementById(fieldName + 'Custom');
        if (customInput) {
          customInput.classList.toggle('show');
          if (customInput.classList.contains('show')) {
            customInput.focus();
          }
        }
      }

      // ä¸ºæ‰€æœ‰è‡ªå®šä¹‰è¾“å…¥æ¡†å’Œæ™®é€šè¾“å…¥æ¡†æ·»åŠ äº‹ä»¶ç›‘å¬å™¨
      function setupCustomInputListeners() {
        const customInputs = document.querySelectorAll('[id$="Custom"]');
        customInputs.forEach(input => {
          input.addEventListener('input', function () {
            const fieldName = this.id.replace('Custom', '');
            // æ ‡è®°ä¸ºç”¨æˆ·é€‰æ‹©
            this.setAttribute('data-user-selected', 'true');
            updateSelectedItems(fieldName);
            
            // å¦‚æœæ˜¯å§“åå­—æ®µï¼Œè¿›è¡Œå®æ—¶éªŒè¯
            if (fieldName === 'realName') {
              validateNameField();
            }
          });
        });

        // ä¸ºæ™®é€šè¾“å…¥æ¡†æ·»åŠ ç”¨æˆ·é€‰æ‹©æ ‡è®°
        const normalInputs = document.querySelectorAll('input, select, textarea');
        normalInputs.forEach(input => {
          if (!input.id.endsWith('Custom')) {
            input.addEventListener('input', function () {
              this.setAttribute('data-user-selected', 'true');
              
              // å¦‚æœæ˜¯å§“åå­—æ®µï¼Œè¿›è¡Œå®æ—¶éªŒè¯
              if (this.id === 'realName') {
                validateNameField();
              }
            });
            input.addEventListener('change', function () {
              this.setAttribute('data-user-selected', 'true');
              
              // å¦‚æœæ˜¯å§“åå­—æ®µï¼Œè¿›è¡Œå®æ—¶éªŒè¯
              if (this.id === 'realName') {
                validateNameField();
              }
            });
          }
        });
      }

      // éšæœºç”Ÿæˆå…¨éƒ¨
      function randomizeAll() {
        if (confirm('ç¡®å®šè¦éšæœºç”Ÿæˆå…¨éƒ¨ä¿¡æ¯å—ï¼Ÿè¿™å°†åªå¡«å……ç©ºç™½éƒ¨åˆ†ï¼Œä¸ä¼šè¦†ç›–å·²å¡«å†™çš„å†…å®¹ã€‚')) {
          // å…ˆéšæœºç”Ÿç†æ€§åˆ«ï¼Œå› ä¸ºå…¶ä»–é€‰é¡¹ä¼šæ ¹æ®æ€§åˆ«è¿›è¡Œç­›é€‰
          randomizeField('biologicalGender');

          // åŸºæœ¬ä¿¡æ¯
          randomizeField('age');
          randomizeField('sexualOrientation');

          // æ€§æ ¼ç‰¹å¾
          randomizeField('positiveTraits');
          randomizeField('negativeTraits');
          randomizeField('loveViews');
          randomizeField('socialStyle');

          // å¤–è²Œè®¾å®šï¼ˆè¿™äº›ä¼šå—æ€§åˆ«å½±å“ï¼‰
          randomizeField('height');
          randomizeField('weight');
          randomizeField('face');
          randomizeField('body');
          randomizeField('dressStyle');

          // å…¶ä»–å¤–è²Œè®¾å®šï¼ˆä¸å—æ€§åˆ«å½±å“ï¼‰
          randomizeField('skinColor');
          randomizeField('eyeColor');
          randomizeField('facialFeatures');
          randomizeField('hairColor');
          randomizeField('hairStyle');
          randomizeField('accessories');

          // å…¶ä»–è®¾å®š
          randomizeField('illness');
          randomizeField('characterTrait');
          randomizeField('bodyScent');
          randomizeField('sensitivity');
          randomizeField('sexualHistory');
          randomizeField('libido');
          randomizeField('kinks');
          randomizeField('hobbies');
          randomizeField('sensitiveSpots');

          // éšæœºåŒ–ç»å†
          randomizeExperienceField('identity');
          randomizeExperienceField('relationshipStatus');

          alert('å·²éšæœºç”Ÿæˆæ‰€æœ‰ä¿¡æ¯ï¼');
        }
      }

      // æ˜¾ç¤ºè¯´æ˜é¡µé¢
      function showInstructionPage() {
        // éšè—åŸå§‹è¡¨å•é¡µé¢
        const mainPanel = document.querySelector('.main-panel:not(.instruction-panel)');
        if (mainPanel) {
          mainPanel.style.display = 'none';
        }

        // æ˜¾ç¤ºè¯´æ˜é¡µé¢
        const instructionPanel = document.getElementById('instructionPanel');
        if (instructionPanel) {
          instructionPanel.style.display = 'flex';

          // æ·»åŠ æ·¡å…¥åŠ¨ç”»æ•ˆæœ
          instructionPanel.style.opacity = '0';
          instructionPanel.style.transition = 'opacity 0.8s ease-in-out';

          setTimeout(() => {
            instructionPanel.style.opacity = '1';
          }, 100);
        }
      }

      // ç¡®è®¤åˆ›å»ºè§’è‰²
      function confirmCreate() {
        
        // å…ˆè¿›è¡Œè¡¨å•éªŒè¯
        if (!validateNameField()) {
          return;
        }
        
        const characterData = collectFormData();

        // è·å–æœ€ç»ˆçš„å§“åï¼ˆä¼˜å…ˆä½¿ç”¨å¸¸è§„è¾“å…¥ï¼Œç„¶åæ˜¯è‡ªå®šä¹‰è¾“å…¥ï¼‰
        const finalName = characterData.realName || 
                         document.getElementById('realNameCustom').value.trim();

        if (!finalName) {
          showFieldError('realName', 'è¯·è¾“å…¥å§“åï¼Œè¿™æ˜¯å¿…å¡«é¡¹');
          alert('è¯·å…ˆå¡«å†™å¿…å¡«é¡¹ç›®ï¼');
          return;
        }

        const confirmMsg = `ç¡®è®¤ç”Ÿæˆè§’è‰²ï¼š${finalName}ï¼Ÿ`;

        if (confirm(confirmMsg)) {

          try {
            // æ˜¾ç¤ºYAMLæ•°æ®
            showYamlModal(characterData);
            
            alert('è§’è‰²æ•°æ®ç”ŸæˆæˆåŠŸï¼è¯·æŸ¥çœ‹YAMLè¾“å‡ºçª—å£ã€‚');

          } catch (error) {
            alert('ç”Ÿæˆè§’è‰²æ•°æ®æ—¶å‘ç”Ÿé”™è¯¯ï¼Œè¯·æ£€æŸ¥æ§åˆ¶å°è·å–è¯¦ç»†ä¿¡æ¯ã€‚');
          }
        }
      }

      // åˆ›å»º InitVar ä¸–ç•Œä¹¦æ¡ç›®
      async function createInitVarLorebookEntry(lorebook, characterData) {
        const userName = characterData.realName || '{{user}}';

        const initVarContent = `{
  "ç”¨æˆ·": {
    "å§“å": ["${userName}", "ç”¨æˆ·çš„å§“åã€‚è¯·å‹¿ä¸»åŠ¨æ›´æ–°æ­¤é¡¹ï¼Œé™¤éç”¨æˆ·æ˜ç¡®è¦æ±‚ä½ æ›´æ–°"],
    "ä½ç½®": ["æœªçŸ¥", "ç”¨æˆ·å½“å‰æ‰€åœ¨çš„åœ°ç‚¹ã€‚"],
    "è¡£ç€": ["æœªçŸ¥", "ç”¨æˆ·å½“å‰çš„ç©¿ç€æè¿°ã€‚"],
    "è¡Œä¸º": ["æœªçŸ¥", "æè¿°ç”¨æˆ·å½“å‰çš„ä¸»è¦è¡Œä¸ºæˆ–å§¿æ€ã€‚"],

    "èº«ä»½": ["${characterData.identity || 'æœªçŸ¥'}", "ç”¨æˆ·å½“å‰çš„èº«ä»½ï¼Œè¯·æ ¹æ®å‰§æƒ…æ›´æ–°"],
    "æ€§æ¬²å€¼": [0, "èŒƒå›´[0, 100]ï¼Œç”¨æˆ·çš„å½“å‰ç”Ÿç†æ¬²æœ›å¼ºåº¦ã€‚å½“ç”¨æˆ·å¤„äºæ€§çˆ±åœºæ™¯æ—¶è·Ÿéšå‰§æƒ…æ›´æ–°ã€‚"],

    "æ—¶é—´": ["æš‚æ— ", "å½“å‰çš„æ—¶é—´,24å°æ—¶åˆ¶,è¯·æ ¹æ®å‰§æƒ…åŠæ—¶æ›´æ–°"],
    "æ—¥æœŸ": ["æš‚æ— ", "å½“å‰çš„æ—¥æœŸï¼Œè¯·æ ¹æ®å‰§æƒ…åŠæ—¶æ›´æ–°ã€‚å¦‚:7/24/2025ï¼Œæˆ–ç¬¬ä¸€å¤©"]
  }
}`;

        const initVarEntry = {
          comment: '[InitVar] ç”¨æˆ·åˆå§‹ï¼ˆè¯·å‹¿æ‰“å¼€æˆ–ä¿®æ”¹ï¼‰',
          enabled: false, // å…³é—­çŠ¶æ€
          position: 'before_character_definition',
          content: initVarContent,
          keys: ['InitVar', 'ç”¨æˆ·åˆå§‹'],
          order: 0,
          priority: 1000,
        };

        await createLorebookEntries(lorebook, [initVarEntry]);
      }

      // åˆ›å»ºç”¨æˆ·äººè®¾ä¸–ç•Œä¹¦æ¡ç›®
      async function createUserProfileLorebookEntry(lorebook, characterData) {
        let profileContent = `#ç”¨æˆ·äººè®¾\nç”¨æˆ·å§“åï¼š${characterData.realName}ã€‚\n\n`;

        // æ·»åŠ åŸºæœ¬ä¿¡æ¯
        if (characterData.age) {
          profileContent += `å¹´é¾„ï¼š${characterData.age}\n`;
        }
        if (characterData.biologicalGender) {
          profileContent += `ç”Ÿç†æ€§åˆ«ï¼š${characterData.biologicalGender}\n`;
        }
        if (characterData.sexualOrientation) {
          profileContent += `æ€§å–å‘ï¼š${characterData.sexualOrientation}\n`;
        }

        // æ·»åŠ æ­£é¢æ€§æ ¼
        if (characterData.positiveTraits && characterData.positiveTraits.length > 0) {
          profileContent += `æ­£é¢æ€§æ ¼ï¼š${characterData.positiveTraits.join('ã€')}\n`;
        }

        // æ·»åŠ è´Ÿé¢æ€§æ ¼
        if (characterData.negativeTraits && characterData.negativeTraits.length > 0) {
          profileContent += `è´Ÿé¢æ€§æ ¼ï¼š${characterData.negativeTraits.join('ã€')}\n`;
        }

        // æ·»åŠ æ„Ÿæƒ…è§‚
        if (characterData.loveViews && characterData.loveViews.length > 0) {
          profileContent += `æ„Ÿæƒ…è§‚ï¼š${characterData.loveViews.join('ã€')}\n`;
        }

        // æ·»åŠ ç¤¾äº¤é£æ ¼
        if (characterData.socialStyle && characterData.socialStyle.length > 0) {
          profileContent += `ç¤¾äº¤é£æ ¼ï¼š${characterData.socialStyle.join('ã€')}\n`;
        }

        // æ·»åŠ å¤–è²Œè®¾å®š
        if (characterData.height) {
          profileContent += `èº«é«˜ï¼š${characterData.height}cm\n`;
        }
        if (characterData.weight) {
          profileContent += `ä½“é‡ï¼š${characterData.weight}kg\n`;
        }
        if (characterData.face && characterData.face.length > 0) {
          profileContent += `é¢è²Œï¼š${characterData.face.join('ã€')}\n`;
        }
        if (characterData.body && characterData.body.length > 0) {
          profileContent += `èº«æï¼š${characterData.body.join('ã€')}\n`;
        }
        if (characterData.skinColor) {
          profileContent += `è‚¤è‰²ï¼š${characterData.skinColor}\n`;
        }
        if (characterData.eyeColor) {
          profileContent += `ç³è‰²ï¼š${characterData.eyeColor}\n`;
        }
        if (characterData.facialFeatures) {
          profileContent += `é¢éƒ¨ç‰¹å¾ï¼š${characterData.facialFeatures}\n`;
        }
        if (characterData.hairColor) {
          profileContent += `å‘è‰²ï¼š${characterData.hairColor}\n`;
        }
        if (characterData.hairStyle) {
          profileContent += `å‘å‹ï¼š${characterData.hairStyle}\n`;
        }
        if (characterData.dressStyle) {
          profileContent += `æ—¥å¸¸ç©¿æ­åå¥½ï¼š${characterData.dressStyle}\n`;
        }
        if (characterData.accessories) {
          profileContent += `æ ‡å¿—æ€§é…é¥°ï¼š${characterData.accessories}\n`;
        }

        // æ·»åŠ å…¶ä»–è®¾å®š
        if (characterData.illness) {
          profileContent += `ç—…ç—‡ï¼š${characterData.illness}\n`;
        }
        if (characterData.characterTrait) {
          profileContent += `äººç‰©ç‰¹ç‚¹ï¼š${characterData.characterTrait}\n`;
        }
        if (characterData.bodyScent) {
          profileContent += `ä½“å‘³ï¼š${characterData.bodyScent}\n`;
        }
        if (characterData.sensitivity) {
          profileContent += `èº«ä½“æ•æ„Ÿåº¦ï¼š${characterData.sensitivity}\n`;
        }
        if (characterData.sexualHistory) {
          profileContent += `è¿‡å¾€æ€§ç»å†ï¼š${characterData.sexualHistory}\n`;
        }
        if (characterData.libido) {
          profileContent += `æ€§æ¬²æŒ‡æ•°ï¼š${characterData.libido}\n`;
        }
        if (characterData.kinks && characterData.kinks.length > 0) {
          profileContent += `æ€§ç™–ï¼š${characterData.kinks.join('ã€')}\n`;
        }
        if (characterData.hobbies && characterData.hobbies.length > 0) {
          profileContent += `çˆ±å¥½ï¼š${characterData.hobbies.join('ã€')}\n`;
        }
        if (characterData.sensitiveSpots && characterData.sensitiveSpots.length > 0) {
          profileContent += `æ•æ„Ÿç‚¹ï¼š${characterData.sensitiveSpots.join('ã€')}\n`;
        }

        // æ·»åŠ æƒ…æ„ŸçŠ¶æ€
        if (characterData.relationshipStatus) {
          profileContent += `è¿‡å¾€æƒ…æ„ŸçŠ¶æ€ï¼š${characterData.relationshipStatus}\n`;
        }

        // æ·»åŠ èº«ä»½
        if (characterData.identity) {
          profileContent += `åˆå§‹èº«ä»½ï¼š${characterData.identity}\n`;
        }

        // æ·»åŠ å…¶ä»–è‡ªå®šä¹‰ä¿¡æ¯
        if (characterData.additionalInfo) {
          profileContent += `è¡¥å……è¯´æ˜ï¼š${characterData.additionalInfo}\n`;
        }

        const userProfileEntry = {
          comment: 'ç”¨æˆ·äººè®¾',
          enabled: true,
          type: 'constant',
          position: 'at_depth_as_system',
          depth: 2,
          content: profileContent,
          keys: ['ç”¨æˆ·äººè®¾', characterData.realName],
          order: 100,
          priority: 500,
        };

        await createLorebookEntries(lorebook, [userProfileEntry]);
      }

      // å‘é€åˆå§‹æ¶ˆæ¯
      async function sendInitialMessage(characterData) {
        let messageContent = `#ç”¨æˆ·äººè®¾\nç”¨æˆ·å§“åï¼š${characterData.realName}ã€‚\n\n`;

        // æ·»åŠ ç”¨æˆ·é€‰æ‹©çš„é€‰é¡¹
        if (characterData.age) {
          messageContent += `å¹´é¾„ï¼š${characterData.age}ï¼Œ`;
        }
        if (characterData.biologicalGender) {
          messageContent += `ç”Ÿç†æ€§åˆ«ï¼š${characterData.biologicalGender}ï¼Œ`;
        }
        if (characterData.psychologicalGender) {
          messageContent += `å¿ƒç†è®¤çŸ¥æ€§åˆ«ï¼š${characterData.psychologicalGender}ï¼Œ`;
        }
        if (characterData.publicGender) {
          messageContent += `å¯¹å¤–å…¬å¼€æ€§åˆ«ï¼š${characterData.publicGender}ï¼Œ`;
        }
        if (characterData.sexualOrientation) {
          messageContent += `æ€§å–å‘ï¼š${characterData.sexualOrientation}ï¼Œ`;
        }
        if (characterData.positiveTraits && characterData.positiveTraits.length > 0) {
          messageContent += `æ­£é¢æ€§æ ¼ï¼š${characterData.positiveTraits.join('ã€')}ï¼Œ`;
        }
        if (characterData.negativeTraits && characterData.negativeTraits.length > 0) {
          messageContent += `è´Ÿé¢æ€§æ ¼ï¼š${characterData.negativeTraits.join('ã€')}ï¼Œ`;
        }
        if (characterData.loveViews && characterData.loveViews.length > 0) {
          messageContent += `æ„Ÿæƒ…è§‚ï¼š${characterData.loveViews.join('ã€')}ï¼Œ`;
        }
        if (characterData.socialStyle && characterData.socialStyle.length > 0) {
          messageContent += `ç¤¾äº¤é£æ ¼ï¼š${characterData.socialStyle.join('ã€')}ï¼Œ`;
        }
        if (characterData.height) {
          messageContent += `èº«é«˜ï¼š${characterData.height}cmï¼Œ`;
        }
        if (characterData.weight) {
          messageContent += `ä½“é‡ï¼š${characterData.weight}kgï¼Œ`;
        }
        if (characterData.face && characterData.face.length > 0) {
          messageContent += `é¢è²Œï¼š${characterData.face.join('ã€')}ï¼Œ`;
        }
        if (characterData.body && characterData.body.length > 0) {
          messageContent += `èº«æï¼š${characterData.body.join('ã€')}ï¼Œ`;
        }
        if (characterData.skinColor) {
          messageContent += `è‚¤è‰²ï¼š${characterData.skinColor}ï¼Œ`;
        }
        if (characterData.eyeColor) {
          messageContent += `ç³è‰²ï¼š${characterData.eyeColor}ï¼Œ`;
        }
        if (characterData.facialFeatures) {
          messageContent += `é¢éƒ¨ç‰¹å¾ï¼š${characterData.facialFeatures}ï¼Œ`;
        }
        if (characterData.hairColor) {
          messageContent += `å‘è‰²ï¼š${characterData.hairColor}ï¼Œ`;
        }
        if (characterData.hairStyle) {
          messageContent += `å‘å‹ï¼š${characterData.hairStyle}ï¼Œ`;
        }
        if (characterData.dressStyle) {
          messageContent += `æ—¥å¸¸ç©¿æ­åå¥½ï¼š${characterData.dressStyle}ï¼Œ`;
        }
        if (characterData.accessories) {
          messageContent += `æ ‡å¿—æ€§é…é¥°ï¼š${characterData.accessories}ï¼Œ`;
        }
        if (characterData.illness) {
          messageContent += `ç—…ç—‡ï¼š${characterData.illness}ï¼Œ`;
        }
        if (characterData.characterTrait) {
          messageContent += `äººç‰©ç‰¹ç‚¹ï¼š${characterData.characterTrait}ï¼Œ`;
        }
        if (characterData.bodyScent) {
          messageContent += `ä½“å‘³ï¼š${characterData.bodyScent}ï¼Œ`;
        }
        if (characterData.sensitivity) {
          messageContent += `èº«ä½“æ•æ„Ÿåº¦ï¼š${characterData.sensitivity}ï¼Œ`;
        }
        if (characterData.sexualHistory) {
          messageContent += `è¿‡å¾€æ€§ç»å†ï¼š${characterData.sexualHistory}ï¼Œ`;
        }
        if (characterData.libido) {
          messageContent += `æ€§æ¬²æŒ‡æ•°ï¼š${characterData.libido}ï¼Œ`;
        }
        if (characterData.kinks && characterData.kinks.length > 0) {
          messageContent += `æ€§ç™–ï¼š${characterData.kinks.join('ã€')}ï¼Œ`;
        }
        if (characterData.hobbies && characterData.hobbies.length > 0) {
          messageContent += `çˆ±å¥½ï¼š${characterData.hobbies.join('ã€')}ï¼Œ`;
        }
        if (characterData.sensitiveSpots && characterData.sensitiveSpots.length > 0) {
          messageContent += `æ•æ„Ÿç‚¹ï¼š${characterData.sensitiveSpots.join('ã€')}ï¼Œ`;
        }

        if (characterData.additionalInfo) {
          messageContent += `è¡¥å……è¯´æ˜ï¼š${characterData.additionalInfo}ï¼Œ`;
        }

        // ç§»é™¤æœ€åçš„é€—å·
        messageContent = messageContent.replace(/ï¼Œ$/, '');

        const chatMessage = {
          role: 'user',
          message: messageContent,
          send_date: '',
        };

        try {
          window.parent.document.querySelector('#send_textarea').value = messageContent;
          //window.parent.document.querySelector('#send_but').click();
        } catch (error) {
          alert('æ— æ³•è‡ªåŠ¨å‘é€ã€‚è§’è‰²ä¿¡æ¯å·²è¾“å‡ºåˆ°æ§åˆ¶å°ï¼Œè¯·æ‰‹åŠ¨å¤åˆ¶ã€‚');
        }
      }

      // æ”¶é›†è¡¨å•æ•°æ®
      function collectFormData() {
        const data = {
          // åŸºæœ¬ä¿¡æ¯
          realName: document.getElementById('realName').value,
          age: document.getElementById('age').value,
          biologicalGender: document.getElementById('biologicalGender').value,
          sexualOrientation: document.getElementById('sexualOrientation').value,

          // æ€§æ ¼ç‰¹å¾
          positiveTraits: getSelectedOptions('positiveTraitsGrid'),
          negativeTraits: getSelectedOptions('negativeTraitsGrid'),
          loveViews: getSelectedOptions('loveViewsGrid'),
          socialStyle: getSelectedOptions('socialStyleGrid'),

          // å¤–è²Œè®¾å®š
          height: document.getElementById('height').value,
          weight: document.getElementById('weight').value,
          face: getSelectedOptions('faceGrid'),
          body: getSelectedOptions('bodyGrid'),
          skinColor: document.getElementById('skinColor').value,
          eyeColor: document.getElementById('eyeColor').value,
          facialFeatures: document.getElementById('facialFeatures').value,
          hairColor: document.getElementById('hairColor').value,
          hairStyle: document.getElementById('hairStyle').value,
          dressStyle: document.getElementById('dressStyle').value,
          accessories: document.getElementById('accessories').value,

          // å…¶ä»–è®¾å®š
          illness: document.getElementById('illness').value,
          characterTrait: document.getElementById('characterTrait').value,
          bodyScent: document.getElementById('bodyScent').value,
          sensitivity: document.getElementById('sensitivity').value,
          sexualHistory: document.getElementById('sexualHistory').value,
          libido: document.getElementById('libido').value,
          kinks: getSelectedOptions('kinksGrid'),
          hobbies: getSelectedOptions('hobbiesGrid'),
          sensitiveSpots: getSelectedOptions('sensitiveSpotsGrid'),

          // å…¶ä»–
          additionalInfo: document.getElementById('additionalInfo').value,

          // ç»å†
          identity: getSelectedSingleOption('identityGrid'),
          relationshipStatus: getSelectedSingleOption('relationshipStatusGrid'),
        };

        // å¤„ç†è‡ªå®šä¹‰è¾“å…¥ - åˆå¹¶è€Œä¸æ˜¯æ›¿æ¢
        Object.keys(data).forEach(key => {
          const customInput = document.getElementById(key + 'Custom');
          if (customInput && customInput.value.trim()) {
            if (Array.isArray(data[key])) {
              // å¯¹äºæ•°ç»„ç±»å‹ï¼Œåˆå¹¶é€‰é¡¹å’Œè‡ªå®šä¹‰è¾“å…¥
              const customItems = customInput.value
                .split(',')
                .map(s => s.trim())
                .filter(s => s);
              data[key] = [...data[key], ...customItems];
            } else {
              // å¯¹äºå•é€‰ç±»å‹ï¼Œå¦‚æœæ²¡æœ‰é€‰æ‹©é€‰é¡¹ï¼Œåˆ™ä½¿ç”¨è‡ªå®šä¹‰è¾“å…¥
              if (!data[key] || data[key] === '') {
                data[key] = customInput.value.trim();
              }
            }
          }
        });

        return data;
      }

      // è·å–é€‰ä¸­çš„é€‰é¡¹
      function getSelectedOptions(gridId) {
        const grid = document.getElementById(gridId);
        if (!grid) return [];

        const selectedBtns = grid.querySelectorAll('.option-btn.selected');
        return Array.from(selectedBtns).map(btn => btn.getAttribute('data-value'));
      }

      // è·å–å•é€‰é€‰é¡¹
      function getSelectedSingleOption(gridId) {
        const grid = document.getElementById(gridId);
        if (!grid) return '';

        const selectedBtn = grid.querySelector('.option-btn.selected');
        return selectedBtn ? selectedBtn.getAttribute('data-value') : '';
      }

      // å…³é—­æ¨¡æ€çª—å£çš„å‡½æ•°
      function closeYamlModal() {
        const modal = document.getElementById('yamlModal');
        
        if (!modal) {
          return;
        }
        
        // æ·»åŠ æ·¡å‡ºåŠ¨ç”»
        modal.style.transition = 'opacity 0.3s ease-in-out';
        modal.style.opacity = '0';
        
        // åŠ¨ç”»å®Œæˆåéšè—
        setTimeout(() => {
          modal.style.display = 'none';
          modal.style.transition = '';
        }, 300);
      }

      // å®‰å…¨çš„äº‹ä»¶ç»‘å®šå‡½æ•°
      function bindModalEvents(modal) {
        
        if (!modal) {
          return;
        }
        
        try {
          // èƒŒæ™¯ç‚¹å‡»å…³é—­
          modal.addEventListener('click', function(e) {
            if (e.target === modal) {
              closeYamlModal();
            }
          });
          
          // å…³é—­æŒ‰é’®ç‚¹å‡»
          const closeBtn = modal.querySelector('.yaml-modal-close');
          
          if (closeBtn) {
            closeBtn.addEventListener('click', function(e) {
              e.preventDefault();
              e.stopPropagation();
              closeYamlModal();
            });
          }
          
          // ESCé”®å…³é—­
          const escHandler = function(e) {
            if (e.key === 'Escape' && modal.style.display === 'block') {
              closeYamlModal();
            }
          };
          document.addEventListener('keydown', escHandler);
          
        } catch (error) {
          // é™é»˜å¤„ç†é”™è¯¯
        }
      }

      // ===== æ‰©å±•æ€§APIå‡½æ•° =====
      
      /**
       * åŠ¨æ€æ·»åŠ æ–°çš„é€‰é¡¹ç»„
       * @param {string} groupName - é€‰é¡¹ç»„åç§°
       * @param {Object} config - é€‰é¡¹ç»„é…ç½®
       * @param {string} config.type - é€‰é¡¹ç±»å‹ ('multi-select' æˆ– 'single-select')
       * @param {boolean} config.genderFilter - æ˜¯å¦æŒ‰æ€§åˆ«ç­›é€‰
       * @param {Array|Object} config.options - é€‰é¡¹åˆ—è¡¨æˆ–æ€§åˆ«åˆ†ç»„çš„é€‰é¡¹
       */
      function addOptionGroup(groupName, config) {
        try {
          OPTIONS_CONFIG[groupName] = config;
          
          // å¦‚æœé¡µé¢å·²åŠ è½½ï¼Œç«‹å³æ›´æ–°å¯¹åº”çš„ç½‘æ ¼
          if (document.readyState === 'complete') {
            const grid = document.getElementById(groupName + 'Grid');
            if (grid) {
              updateOptionsGrid(groupName, getCurrentGender());
            }
          }
        } catch (error) {
          // é™é»˜å¤„ç†é”™è¯¯
        }
      }

      /**
       * æ›´æ–°ç°æœ‰é€‰é¡¹ç»„çš„é€‰é¡¹
       * @param {string} groupName - é€‰é¡¹ç»„åç§°  
       * @param {Array|Object} newOptions - æ–°çš„é€‰é¡¹åˆ—è¡¨
       */
      function updateOptionGroup(groupName, newOptions) {
        try {
          if (OPTIONS_CONFIG[groupName]) {
            OPTIONS_CONFIG[groupName].options = newOptions;
            
            // ç«‹å³åˆ·æ–°å¯¹åº”çš„ç½‘æ ¼
            const grid = document.getElementById(groupName + 'Grid');
            if (grid) {
              updateOptionsGrid(groupName, getCurrentGender());
            }
          }
        } catch (error) {
          // é™é»˜å¤„ç†é”™è¯¯
        }
      }

      /**
       * é‡æ–°åˆå§‹åŒ–æ‰€æœ‰é€‰é¡¹ç»„
       */
      function initializeAllOptionGroups() {
        try {
          // è·å–å½“å‰æ€§åˆ«
          const currentGender = getCurrentGender();
          
          // é‡æ–°åˆå§‹åŒ–æ‰€æœ‰é€‰é¡¹ç»„
          Object.keys(CHARACTER_OPTIONS_CONFIG).forEach(groupName => {
            const config = CHARACTER_OPTIONS_CONFIG[groupName];
            if (config && config.type === 'multi-select') {
              updateOptionsGrid(groupName, currentGender);
            }
          });
          
          // é‡æ–°åˆå§‹åŒ–æ€§åˆ«å’Œèº«ä»½ä¸‹æ‹‰æ¡†
          initializeGenderOptions();
          initializeIdentityOptions();
          
        } catch (error) {
          console.warn('é‡æ–°åˆå§‹åŒ–é€‰é¡¹ç»„æ—¶å‡ºé”™:', error);
        }
      }

      /**
       * åˆå§‹åŒ–æ€§åˆ«é€‰é¡¹
       */
      function initializeGenderOptions() {
        const genderSelect = document.getElementById('biologicalGender');
        if (genderSelect && UNIVERSAL_SEXUAL_OPTIONS.biologicalGender) {
          updateSelectOptions('biologicalGender', UNIVERSAL_SEXUAL_OPTIONS.biologicalGender);
        }
      }

      /**
       * åˆå§‹åŒ–èº«ä»½é€‰é¡¹
       */
      function initializeIdentityOptions() {
        const world = WORLDS_CONFIG[currentWorld];
        if (world && world.identity && world.identity.options) {
          updateSelectOptions('identity', world.identity.options);
        }
      }

      /**
       * ç§»é™¤é€‰é¡¹ç»„
       * @param {string} groupName - è¦ç§»é™¤çš„é€‰é¡¹ç»„åç§°
       */
      function removeOptionGroup(groupName) {
        try {
          if (OPTIONS_CONFIG[groupName]) {
            delete OPTIONS_CONFIG[groupName];
            
            // æ¸…ç©ºå¯¹åº”çš„ç½‘æ ¼
            const grid = document.getElementById(groupName + 'Grid');
            if (grid) {
              grid.innerHTML = '<!-- é€‰é¡¹ç»„å·²ç§»é™¤ -->';
            }
          }
        } catch (error) {
          // é™é»˜å¤„ç†é”™è¯¯
        }
      }

      /**
       * è·å–å½“å‰æ‰€æœ‰é€‰é¡¹ç»„çš„é…ç½®
       * @returns {Object} æ‰€æœ‰é€‰é¡¹ç»„é…ç½®çš„å‰¯æœ¬
       */
      function getAllOptionGroups() {
        return JSON.parse(JSON.stringify(OPTIONS_CONFIG));
      }

      /**
       * è·å–ç‰¹å®šé€‰é¡¹ç»„çš„é…ç½®
       * @param {string} groupName - é€‰é¡¹ç»„åç§°
       * @returns {Object|null} é€‰é¡¹ç»„é…ç½®çš„å‰¯æœ¬ï¼Œä¸å­˜åœ¨åˆ™è¿”å›null
       */
      function getOptionGroup(groupName) {
        if (CHARACTER_OPTIONS_CONFIG[groupName]) {
          return JSON.parse(JSON.stringify(CHARACTER_OPTIONS_CONFIG[groupName]));
        }
        return null;
      }

      // å°†APIå‡½æ•°æš´éœ²åˆ°å…¨å±€ä½œç”¨åŸŸï¼Œæ–¹ä¾¿å¤–éƒ¨è°ƒç”¨
      window.CharacterGeneratorAPI = {
        addOptionGroup,
        updateOptionGroup, 
        removeOptionGroup,
        getAllOptionGroups,
        getOptionGroup,
        // ä¹Ÿæš´éœ²ä¸€äº›æ ¸å¿ƒå‡½æ•°
        updateOptionsGrid,
        getRandomOptions,
        getOptionsByGender
      };

      // é¡µé¢åŠ è½½å®Œæˆåçš„åˆå§‹åŒ–
      document.addEventListener('DOMContentLoaded', function () {
        
        // è®¾ç½®è‡ªå®šä¹‰è¾“å…¥æ¡†çš„äº‹ä»¶ç›‘å¬å™¨
        setupCustomInputListeners();

        // æ·»åŠ æ€§åˆ«å˜åŒ–ç›‘å¬å™¨
        const biologicalGenderSelect = document.getElementById('biologicalGender');
        if (biologicalGenderSelect) {
          biologicalGenderSelect.addEventListener('change', function() {
            const currentGender = this.value;
            // å½“æ€§åˆ«å˜åŒ–æ—¶ï¼Œæ›´æ–°æ‰€æœ‰æ€§åˆ«ç‰¹å®šçš„é€‰é¡¹ç½‘æ ¼
            Object.keys(CHARACTER_OPTIONS_CONFIG).forEach(fieldName => {
              const config = CHARACTER_OPTIONS_CONFIG[fieldName];
              if (config && config.genderSpecific) {
                updateOptionsGrid(fieldName, currentGender);
              }
            });
            
            // åŒæ—¶æ›´æ–°æ€§åˆ«ç‰¹å®šçš„ä¸‹æ‹‰æ¡†é€‰é¡¹
            updateGenderSpecificSelects(currentGender);
          });
        }

        // åˆå§‹åŒ–åŠ¨æ€é€‰é¡¹ç½‘æ ¼
        try {
          Object.keys(CHARACTER_OPTIONS_CONFIG).forEach(fieldName => {
            updateOptionsGrid(fieldName, getCurrentGender());
          });
        } catch (error) {
          // é™é»˜å¤„ç†é”™è¯¯
        }

        // éªŒè¯å…³é”®å…ƒç´ æ˜¯å¦å­˜åœ¨
        const yamlModal = document.getElementById('yamlModal');
        const yamlOutput = document.getElementById('yamlOutput');
        const copyBtn = document.getElementById('copyYamlBtn');

        // ç»‘å®šæ¨¡æ€çª—å£äº‹ä»¶
        if (yamlModal) {
          bindModalEvents(yamlModal);
        }

        // å¤åˆ¶æŒ‰é’®
        if (copyBtn) {
          copyBtn.addEventListener('click', function(e) {
            e.stopPropagation(); // é˜²æ­¢äº‹ä»¶å†’æ³¡åˆ°æ¨¡æ€çª—å£
            copyYamlToClipboard();
          });
        }
      });

      // æ˜¾ç¤ºYAMLæ¨¡æ€çª—å£
      function showYamlModal(yamlData) {
        
        const modal = document.getElementById('yamlModal');
        const output = document.getElementById('yamlOutput');
        
        if (!modal) {
          alert('ç³»ç»Ÿé”™è¯¯ï¼šæ‰¾ä¸åˆ°YAMLæ˜¾ç¤ºçª—å£');
          return;
        }
        
        if (!output) {
          alert('ç³»ç»Ÿé”™è¯¯ï¼šæ‰¾ä¸åˆ°YAMLè¾“å‡ºåŒºåŸŸ');
          return;
        }
        
        try {
          const yamlString = jsyaml.dump(yamlData, {indent: 2, lineWidth: 120});
          
          output.value = yamlString;
          
          // ç¡®ä¿æ¨¡æ€çª—å£å¯è§
          modal.style.display = 'block';
          modal.style.opacity = '0';
          
          // ä½¿ç”¨requestAnimationFrameç¡®ä¿DOMæ›´æ–°åå†æ˜¾ç¤ºåŠ¨ç”»
          requestAnimationFrame(() => {
            modal.style.transition = 'opacity 0.3s ease-in-out';
            modal.style.opacity = '1';
          });
          
          // èšç„¦åˆ°è¾“å‡ºåŒºåŸŸä»¥ä¾¿ç”¨æˆ·å¯ä»¥ç›´æ¥æ“ä½œ
          setTimeout(() => {
            output.focus();
          }, 100);
          
        } catch (error) {
          alert('ç³»ç»Ÿé”™è¯¯ï¼šæ— æ³•ç”ŸæˆYAMLæ•°æ® - ' + error.message);
        }
      }

      // å¤åˆ¶YAMLåˆ°å‰ªè´´æ¿
      async function copyYamlToClipboard() {
        
        const output = document.getElementById('yamlOutput');
        if (!output) {
          alert('ç³»ç»Ÿé”™è¯¯ï¼šæ‰¾ä¸åˆ°YAMLè¾“å‡ºåŒºåŸŸ');
          return;
        }
        
        const textToCopy = output.value.trim();
        if (!textToCopy) {
          alert('æ²¡æœ‰å¯å¤åˆ¶çš„YAMLæ•°æ®');
          return;
        }
        
        // æ–¹æ³•1: ç°ä»£æµè§ˆå™¨ Clipboard API
        if (navigator.clipboard && window.isSecureContext) {
          try {
            await navigator.clipboard.writeText(textToCopy);
            alert('YAMLæ•°æ®å·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼');
            return;
          } catch (err) {
            // ç»§ç»­å°è¯•å…¶ä»–æ–¹æ³•
          }
        }
        
        // æ–¹æ³•2: ä¼ ç»Ÿ execCommand æ–¹æ³•
        try {
          output.select();
          output.setSelectionRange(0, 99999);
          const successful = document.execCommand('copy');
          
          if (successful) {
            alert('YAMLæ•°æ®å·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼');
            return;
          }
        } catch (err) {
          // ç»§ç»­åˆ°æ–¹æ³•3
        }
        
        // æ–¹æ³•3: æ‰‹åŠ¨å¤åˆ¶æç¤º
        output.focus();
        output.select();
        alert('è‡ªåŠ¨å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨å¤åˆ¶ã€‚å·²ä¸ºæ‚¨é€‰ä¸­æ–‡æœ¬ï¼Œè¯·æŒ‰ Ctrl+C (Mac: Cmd+C)');
      }
    </script>
  </body>
</html>